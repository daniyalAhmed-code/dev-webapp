{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs3/helpers/objectSpread2\";\nimport _typeof from \"@babel/runtime-corejs3/helpers/typeof\";\nimport _createForOfIteratorHelper from \"@babel/runtime-corejs3/helpers/createForOfIteratorHelper\";\nimport _classCallCheck from \"@babel/runtime-corejs3/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs3/helpers/createClass\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs3/regenerator\";\nimport _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";\nimport _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";\nimport _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";\nimport _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";\nimport _Object$keys2 from \"@babel/runtime-corejs3/core-js-stable/object/keys\";\nimport _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";\nimport _Promise from \"@babel/runtime-corejs3/core-js-stable/promise\";\nimport _spliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/splice\";\nimport _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";\nimport lib from './lib';\nimport refs from './lib/refs';\nimport allOf from './lib/all-of';\nimport parameters from './lib/parameters';\nimport properties from './lib/properties';\nimport ContextTree from './lib/context-tree';\nvar HARD_LIMIT = 100;\n\nvar noop = function noop() {};\n\nvar SpecMap = /*#__PURE__*/function () {\n  function SpecMap(opts) {\n    var _this = this,\n        _context,\n        _context2;\n\n    _classCallCheck(this, SpecMap);\n\n    _Object$assign(this, {\n      spec: '',\n      debugLevel: 'info',\n      plugins: [],\n      pluginHistory: {},\n      errors: [],\n      mutations: [],\n      promisedPatches: [],\n      state: {},\n      patches: [],\n      context: {},\n      contextTree: new ContextTree(),\n      showDebug: false,\n      allPatches: [],\n      // only populated if showDebug is true\n      pluginProp: 'specMap',\n      libMethods: _Object$assign(Object.create(this), lib, {\n        getInstance: function getInstance() {\n          return _this;\n        }\n      }),\n      allowMetaPatches: false\n    }, opts); // Lib methods bound\n\n\n    this.get = this._get.bind(this); // eslint-disable-line no-underscore-dangle\n\n    this.getContext = this._getContext.bind(this); // eslint-disable-line no-underscore-dangle\n\n    this.hasRun = this._hasRun.bind(this); // eslint-disable-line no-underscore-dangle\n\n    this.wrappedPlugins = _filterInstanceProperty(_context = _mapInstanceProperty(_context2 = this.plugins).call(_context2, this.wrapPlugin.bind(this))).call(_context, lib.isFunction); // Initial patch(s)\n\n    this.patches.push(lib.add([], this.spec));\n    this.patches.push(lib.context([], this.context));\n    this.updatePatches(this.patches);\n  }\n\n  _createClass(SpecMap, [{\n    key: \"debug\",\n    value: function debug(level) {\n      if (this.debugLevel === level) {\n        var _console;\n\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        (_console = console).log.apply(_console, args); // eslint-disable-line no-console\n\n      }\n    }\n  }, {\n    key: \"verbose\",\n    value: function verbose(header) {\n      if (this.debugLevel === 'verbose') {\n        var _console2, _context3;\n\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        (_console2 = console).log.apply(_console2, _concatInstanceProperty(_context3 = [\"[\".concat(header, \"]   \")]).call(_context3, args)); // eslint-disable-line no-console\n\n      }\n    }\n  }, {\n    key: \"wrapPlugin\",\n    value: function wrapPlugin(plugin, name) {\n      var pathDiscriminator = this.pathDiscriminator;\n      var ctx = null;\n      var fn;\n\n      if (plugin[this.pluginProp]) {\n        ctx = plugin;\n        fn = plugin[this.pluginProp];\n      } else if (lib.isFunction(plugin)) {\n        fn = plugin;\n      } else if (lib.isObject(plugin)) {\n        fn = createKeyBasedPlugin(plugin);\n      }\n\n      return _Object$assign(fn.bind(ctx), {\n        pluginName: plugin.name || name,\n        isGenerator: lib.isGenerator(fn)\n      }); // Expected plugin interface: {key: string, plugin: fn*}\n      // This traverses depth-first and immediately applies yielded patches.\n      // This strategy should work well for most plugins (including the built-ins).\n      // We might consider making this (traversing & application) configurable later.\n\n      function createKeyBasedPlugin(pluginObj) {\n        var isSubPath = function isSubPath(path, tested) {\n          if (!Array.isArray(path)) {\n            return true;\n          }\n\n          return path.every(function (val, i) {\n            return val === tested[i];\n          });\n        };\n\n        return /*#__PURE__*/_regeneratorRuntime.mark(function generator(patches, specmap) {\n          var _marked, refCache, _iterator, _step, patch, traverse;\n\n          return _regeneratorRuntime.wrap(function generator$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  traverse = function _traverse(obj, path, patch) {\n                    var parentIndex, parent, indexOfFirstProperties, isRootProperties, traversed, _i, _Object$keys, key, val, updatedPath, isObj, objRef, isWithinPathDiscriminator;\n\n                    return _regeneratorRuntime.wrap(function traverse$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            if (lib.isObject(obj)) {\n                              _context4.next = 6;\n                              break;\n                            }\n\n                            if (!(pluginObj.key === path[path.length - 1])) {\n                              _context4.next = 4;\n                              break;\n                            }\n\n                            _context4.next = 4;\n                            return pluginObj.plugin(obj, pluginObj.key, path, specmap);\n\n                          case 4:\n                            _context4.next = 30;\n                            break;\n\n                          case 6:\n                            parentIndex = path.length - 1;\n                            parent = path[parentIndex];\n                            indexOfFirstProperties = path.indexOf('properties');\n                            isRootProperties = parent === 'properties' && parentIndex === indexOfFirstProperties;\n                            traversed = specmap.allowMetaPatches && refCache[obj.$$ref]; // eslint-disable-next-line no-restricted-syntax\n\n                            _i = 0, _Object$keys = _Object$keys2(obj);\n\n                          case 12:\n                            if (!(_i < _Object$keys.length)) {\n                              _context4.next = 30;\n                              break;\n                            }\n\n                            key = _Object$keys[_i];\n                            val = obj[key];\n                            updatedPath = _concatInstanceProperty(path).call(path, key);\n                            isObj = lib.isObject(val);\n                            objRef = obj.$$ref;\n\n                            if (traversed) {\n                              _context4.next = 22;\n                              break;\n                            }\n\n                            if (!isObj) {\n                              _context4.next = 22;\n                              break;\n                            } // Only store the ref if it exists\n\n\n                            if (specmap.allowMetaPatches && objRef) {\n                              refCache[objRef] = true;\n                            }\n\n                            return _context4.delegateYield(traverse(val, updatedPath, patch), \"t0\", 22);\n\n                          case 22:\n                            if (!(!isRootProperties && key === pluginObj.key)) {\n                              _context4.next = 27;\n                              break;\n                            }\n\n                            isWithinPathDiscriminator = isSubPath(pathDiscriminator, path);\n\n                            if (!(!pathDiscriminator || isWithinPathDiscriminator)) {\n                              _context4.next = 27;\n                              break;\n                            }\n\n                            _context4.next = 27;\n                            return pluginObj.plugin(val, key, updatedPath, specmap, patch);\n\n                          case 27:\n                            _i++;\n                            _context4.next = 12;\n                            break;\n\n                          case 30:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _marked);\n                  };\n\n                  _marked = /*#__PURE__*/_regeneratorRuntime.mark(traverse);\n                  refCache = {}; // eslint-disable-next-line no-restricted-syntax\n\n                  _iterator = _createForOfIteratorHelper(_filterInstanceProperty(patches).call(patches, lib.isAdditiveMutation));\n                  _context5.prev = 4;\n\n                  _iterator.s();\n\n                case 6:\n                  if ((_step = _iterator.n()).done) {\n                    _context5.next = 11;\n                    break;\n                  }\n\n                  patch = _step.value;\n                  return _context5.delegateYield(traverse(patch.value, patch.path, patch), \"t0\", 9);\n\n                case 9:\n                  _context5.next = 6;\n                  break;\n\n                case 11:\n                  _context5.next = 16;\n                  break;\n\n                case 13:\n                  _context5.prev = 13;\n                  _context5.t1 = _context5[\"catch\"](4);\n\n                  _iterator.e(_context5.t1);\n\n                case 16:\n                  _context5.prev = 16;\n\n                  _iterator.f();\n\n                  return _context5.finish(16);\n\n                case 19:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }, generator, null, [[4, 13, 16, 19]]);\n        });\n      }\n    }\n  }, {\n    key: \"nextPlugin\",\n    value: function nextPlugin() {\n      var _context6,\n          _this2 = this;\n\n      return _findInstanceProperty(_context6 = this.wrappedPlugins).call(_context6, function (plugin) {\n        var mutations = _this2.getMutationsForPlugin(plugin);\n\n        return mutations.length > 0;\n      });\n    }\n  }, {\n    key: \"nextPromisedPatch\",\n    value: function nextPromisedPatch() {\n      if (this.promisedPatches.length > 0) {\n        var _context7;\n\n        return _Promise.race(_mapInstanceProperty(_context7 = this.promisedPatches).call(_context7, function (patch) {\n          return patch.value;\n        }));\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"getPluginHistory\",\n    value: function getPluginHistory(plugin) {\n      var name = this.constructor.getPluginName(plugin);\n      return this.pluginHistory[name] || [];\n    }\n  }, {\n    key: \"getPluginRunCount\",\n    value: function getPluginRunCount(plugin) {\n      return this.getPluginHistory(plugin).length;\n    }\n  }, {\n    key: \"getPluginHistoryTip\",\n    value: function getPluginHistoryTip(plugin) {\n      var history = this.getPluginHistory(plugin);\n      var val = history && history[history.length - 1];\n      return val || {};\n    }\n  }, {\n    key: \"getPluginMutationIndex\",\n    value: function getPluginMutationIndex(plugin) {\n      var mi = this.getPluginHistoryTip(plugin).mutationIndex;\n      return typeof mi !== 'number' ? -1 : mi;\n    }\n  }, {\n    key: \"updatePluginHistory\",\n    value: function updatePluginHistory(plugin, val) {\n      var name = this.constructor.getPluginName(plugin);\n      this.pluginHistory[name] = this.pluginHistory[name] || [];\n      this.pluginHistory[name].push(val);\n    }\n  }, {\n    key: \"updatePatches\",\n    value: function updatePatches(patches) {\n      var _this3 = this;\n\n      lib.normalizeArray(patches).forEach(function (patch) {\n        if (patch instanceof Error) {\n          _this3.errors.push(patch);\n\n          return;\n        }\n\n        try {\n          if (!lib.isObject(patch)) {\n            _this3.debug('updatePatches', 'Got a non-object patch', patch);\n\n            return;\n          }\n\n          if (_this3.showDebug) {\n            _this3.allPatches.push(patch);\n          }\n\n          if (lib.isPromise(patch.value)) {\n            _this3.promisedPatches.push(patch);\n\n            _this3.promisedPatchThen(patch);\n\n            return;\n          }\n\n          if (lib.isContextPatch(patch)) {\n            _this3.setContext(patch.path, patch.value);\n\n            return;\n          }\n\n          if (lib.isMutation(patch)) {\n            _this3.updateMutations(patch);\n\n            return;\n          }\n        } catch (e) {\n          console.error(e); // eslint-disable-line no-console\n\n          _this3.errors.push(e);\n        }\n      });\n    }\n  }, {\n    key: \"updateMutations\",\n    value: function updateMutations(patch) {\n      if (_typeof(patch.value) === 'object' && !Array.isArray(patch.value) && this.allowMetaPatches) {\n        patch.value = _objectSpread({}, patch.value);\n      }\n\n      var result = lib.applyPatch(this.state, patch, {\n        allowMetaPatches: this.allowMetaPatches\n      });\n\n      if (result) {\n        this.mutations.push(patch);\n        this.state = result;\n      }\n    }\n  }, {\n    key: \"removePromisedPatch\",\n    value: function removePromisedPatch(patch) {\n      var _context8;\n\n      var index = this.promisedPatches.indexOf(patch);\n\n      if (index < 0) {\n        this.debug(\"Tried to remove a promisedPatch that isn't there!\");\n        return;\n      }\n\n      _spliceInstanceProperty(_context8 = this.promisedPatches).call(_context8, index, 1);\n    }\n  }, {\n    key: \"promisedPatchThen\",\n    value: function promisedPatchThen(patch) {\n      var _this4 = this;\n\n      patch.value = patch.value.then(function (val) {\n        var promisedPatch = _objectSpread(_objectSpread({}, patch), {}, {\n          value: val\n        });\n\n        _this4.removePromisedPatch(patch);\n\n        _this4.updatePatches(promisedPatch);\n      }).catch(function (e) {\n        _this4.removePromisedPatch(patch);\n\n        _this4.updatePatches(e);\n      });\n      return patch.value;\n    }\n  }, {\n    key: \"getMutations\",\n    value: function getMutations(from, to) {\n      var _context9;\n\n      from = from || 0;\n\n      if (typeof to !== 'number') {\n        to = this.mutations.length;\n      }\n\n      return _sliceInstanceProperty(_context9 = this.mutations).call(_context9, from, to);\n    }\n  }, {\n    key: \"getCurrentMutations\",\n    value: function getCurrentMutations() {\n      return this.getMutationsForPlugin(this.getCurrentPlugin());\n    }\n  }, {\n    key: \"getMutationsForPlugin\",\n    value: function getMutationsForPlugin(plugin) {\n      var tip = this.getPluginMutationIndex(plugin);\n      return this.getMutations(tip + 1);\n    }\n  }, {\n    key: \"getCurrentPlugin\",\n    value: function getCurrentPlugin() {\n      return this.currentPlugin;\n    }\n  }, {\n    key: \"getLib\",\n    value: function getLib() {\n      return this.libMethods;\n    } // eslint-disable-next-line no-underscore-dangle\n\n  }, {\n    key: \"_get\",\n    value: function _get(path) {\n      return lib.getIn(this.state, path);\n    } // eslint-disable-next-line no-underscore-dangle\n\n  }, {\n    key: \"_getContext\",\n    value: function _getContext(path) {\n      return this.contextTree.get(path);\n    }\n  }, {\n    key: \"setContext\",\n    value: function setContext(path, value) {\n      return this.contextTree.set(path, value);\n    } // eslint-disable-next-line no-underscore-dangle\n\n  }, {\n    key: \"_hasRun\",\n    value: function _hasRun(count) {\n      var times = this.getPluginRunCount(this.getCurrentPlugin());\n      return times > (count || 0);\n    }\n  }, {\n    key: \"dispatch\",\n    value: function dispatch() {\n      var _this5 = this;\n\n      var that = this;\n      var plugin = this.nextPlugin();\n\n      if (!plugin) {\n        var nextPromise = this.nextPromisedPatch();\n\n        if (nextPromise) {\n          return nextPromise.then(function () {\n            return _this5.dispatch();\n          }).catch(function () {\n            return _this5.dispatch();\n          });\n        } // We're done!\n\n\n        var result = {\n          spec: this.state,\n          errors: this.errors\n        };\n\n        if (this.showDebug) {\n          result.patches = this.allPatches;\n        }\n\n        return _Promise.resolve(result);\n      } // Makes sure plugin isn't running an endless loop\n\n\n      that.pluginCount = that.pluginCount || {};\n      that.pluginCount[plugin] = (that.pluginCount[plugin] || 0) + 1;\n\n      if (that.pluginCount[plugin] > HARD_LIMIT) {\n        var _context10;\n\n        return _Promise.resolve({\n          spec: that.state,\n          errors: _concatInstanceProperty(_context10 = that.errors).call(_context10, new Error(\"We've reached a hard limit of \".concat(HARD_LIMIT, \" plugin runs\")))\n        });\n      } // A different plugin runs, wait for all promises to resolve, then retry\n\n\n      if (plugin !== this.currentPlugin && this.promisedPatches.length) {\n        var _context11;\n\n        var promises = _mapInstanceProperty(_context11 = this.promisedPatches).call(_context11, function (p) {\n          return p.value;\n        }); // Waits for all to settle instead of Promise.all which stops on rejection\n\n\n        return _Promise.all(_mapInstanceProperty(promises).call(promises, function (promise) {\n          return promise.then(noop, noop);\n        })).then(function () {\n          return _this5.dispatch();\n        });\n      } // Ok, run the plugin\n\n\n      return executePlugin();\n\n      function executePlugin() {\n        that.currentPlugin = plugin;\n        var mutations = that.getCurrentMutations();\n        var lastMutationIndex = that.mutations.length - 1;\n\n        try {\n          if (plugin.isGenerator) {\n            // eslint-disable-next-line no-restricted-syntax\n            var _iterator2 = _createForOfIteratorHelper(plugin(mutations, that.getLib())),\n                _step2;\n\n            try {\n              for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                var yieldedPatches = _step2.value;\n                updatePatches(yieldedPatches);\n              }\n            } catch (err) {\n              _iterator2.e(err);\n            } finally {\n              _iterator2.f();\n            }\n          } else {\n            var newPatches = plugin(mutations, that.getLib());\n            updatePatches(newPatches);\n          }\n        } catch (e) {\n          console.error(e); // eslint-disable-line no-console\n\n          updatePatches([_Object$assign(Object.create(e), {\n            plugin: plugin\n          })]);\n        } finally {\n          that.updatePluginHistory(plugin, {\n            mutationIndex: lastMutationIndex\n          });\n        }\n\n        return that.dispatch();\n      }\n\n      function updatePatches(patches) {\n        if (patches) {\n          patches = lib.fullyNormalizeArray(patches);\n          that.updatePatches(patches, plugin);\n        }\n      }\n    }\n  }], [{\n    key: \"getPluginName\",\n    value: function getPluginName(plugin) {\n      return plugin.pluginName;\n    }\n  }, {\n    key: \"getPatchesOfType\",\n    value: function getPatchesOfType(patches, fn) {\n      return _filterInstanceProperty(patches).call(patches, fn);\n    }\n  }]);\n\n  return SpecMap;\n}();\n\nexport default function mapSpec(opts) {\n  return new SpecMap(opts).dispatch();\n}\nvar plugins = {\n  refs: refs,\n  allOf: allOf,\n  parameters: parameters,\n  properties: properties\n};\nexport { SpecMap, plugins };","map":{"version":3,"sources":["/home/daniyal/Downloads/vap-webapp (1)/vap-webapp/web-content/static-asset-uploader/node_modules/swagger-client/es/specmap/index.js"],"names":["_objectSpread","_typeof","_createForOfIteratorHelper","_classCallCheck","_createClass","_regeneratorRuntime","_Object$assign","_filterInstanceProperty","_mapInstanceProperty","_concatInstanceProperty","_Object$keys2","_findInstanceProperty","_Promise","_spliceInstanceProperty","_sliceInstanceProperty","lib","refs","allOf","parameters","properties","ContextTree","HARD_LIMIT","noop","SpecMap","opts","_this","_context","_context2","spec","debugLevel","plugins","pluginHistory","errors","mutations","promisedPatches","state","patches","context","contextTree","showDebug","allPatches","pluginProp","libMethods","Object","create","getInstance","allowMetaPatches","get","_get","bind","getContext","_getContext","hasRun","_hasRun","wrappedPlugins","call","wrapPlugin","isFunction","push","add","updatePatches","key","value","debug","level","_console","_len","arguments","length","args","Array","_key","console","log","apply","verbose","header","_console2","_context3","_len2","_key2","concat","plugin","name","pathDiscriminator","ctx","fn","isObject","createKeyBasedPlugin","pluginName","isGenerator","pluginObj","isSubPath","path","tested","isArray","every","val","i","mark","generator","specmap","_marked","refCache","_iterator","_step","patch","traverse","wrap","generator$","_context5","prev","next","_traverse","obj","parentIndex","parent","indexOfFirstProperties","isRootProperties","traversed","_i","_Object$keys","updatedPath","isObj","objRef","isWithinPathDiscriminator","traverse$","_context4","indexOf","$$ref","delegateYield","stop","isAdditiveMutation","s","n","done","t1","e","f","finish","nextPlugin","_context6","_this2","getMutationsForPlugin","nextPromisedPatch","_context7","race","undefined","getPluginHistory","constructor","getPluginName","getPluginRunCount","getPluginHistoryTip","history","getPluginMutationIndex","mi","mutationIndex","updatePluginHistory","_this3","normalizeArray","forEach","Error","isPromise","promisedPatchThen","isContextPatch","setContext","isMutation","updateMutations","error","result","applyPatch","removePromisedPatch","_context8","index","_this4","then","promisedPatch","catch","getMutations","from","to","_context9","getCurrentMutations","getCurrentPlugin","tip","currentPlugin","getLib","getIn","set","count","times","dispatch","_this5","that","nextPromise","resolve","pluginCount","_context10","_context11","promises","p","all","promise","executePlugin","lastMutationIndex","_iterator2","_step2","yieldedPatches","err","newPatches","fullyNormalizeArray","getPatchesOfType","mapSpec"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime-corejs3/helpers/objectSpread2\";\nimport _typeof from \"@babel/runtime-corejs3/helpers/typeof\";\nimport _createForOfIteratorHelper from \"@babel/runtime-corejs3/helpers/createForOfIteratorHelper\";\nimport _classCallCheck from \"@babel/runtime-corejs3/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs3/helpers/createClass\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs3/regenerator\";\nimport _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";\nimport _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";\nimport _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";\nimport _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";\nimport _Object$keys2 from \"@babel/runtime-corejs3/core-js-stable/object/keys\";\nimport _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";\nimport _Promise from \"@babel/runtime-corejs3/core-js-stable/promise\";\nimport _spliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/splice\";\nimport _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";\nimport lib from './lib';\nimport refs from './lib/refs';\nimport allOf from './lib/all-of';\nimport parameters from './lib/parameters';\nimport properties from './lib/properties';\nimport ContextTree from './lib/context-tree';\nvar HARD_LIMIT = 100;\n\nvar noop = function noop() {};\n\nvar SpecMap = /*#__PURE__*/function () {\n  function SpecMap(opts) {\n    var _this = this,\n        _context,\n        _context2;\n\n    _classCallCheck(this, SpecMap);\n\n    _Object$assign(this, {\n      spec: '',\n      debugLevel: 'info',\n      plugins: [],\n      pluginHistory: {},\n      errors: [],\n      mutations: [],\n      promisedPatches: [],\n      state: {},\n      patches: [],\n      context: {},\n      contextTree: new ContextTree(),\n      showDebug: false,\n      allPatches: [],\n      // only populated if showDebug is true\n      pluginProp: 'specMap',\n      libMethods: _Object$assign(Object.create(this), lib, {\n        getInstance: function getInstance() {\n          return _this;\n        }\n      }),\n      allowMetaPatches: false\n    }, opts); // Lib methods bound\n\n\n    this.get = this._get.bind(this); // eslint-disable-line no-underscore-dangle\n\n    this.getContext = this._getContext.bind(this); // eslint-disable-line no-underscore-dangle\n\n    this.hasRun = this._hasRun.bind(this); // eslint-disable-line no-underscore-dangle\n\n    this.wrappedPlugins = _filterInstanceProperty(_context = _mapInstanceProperty(_context2 = this.plugins).call(_context2, this.wrapPlugin.bind(this))).call(_context, lib.isFunction); // Initial patch(s)\n\n    this.patches.push(lib.add([], this.spec));\n    this.patches.push(lib.context([], this.context));\n    this.updatePatches(this.patches);\n  }\n\n  _createClass(SpecMap, [{\n    key: \"debug\",\n    value: function debug(level) {\n      if (this.debugLevel === level) {\n        var _console;\n\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        (_console = console).log.apply(_console, args); // eslint-disable-line no-console\n\n      }\n    }\n  }, {\n    key: \"verbose\",\n    value: function verbose(header) {\n      if (this.debugLevel === 'verbose') {\n        var _console2, _context3;\n\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        (_console2 = console).log.apply(_console2, _concatInstanceProperty(_context3 = [\"[\".concat(header, \"]   \")]).call(_context3, args)); // eslint-disable-line no-console\n\n      }\n    }\n  }, {\n    key: \"wrapPlugin\",\n    value: function wrapPlugin(plugin, name) {\n      var pathDiscriminator = this.pathDiscriminator;\n      var ctx = null;\n      var fn;\n\n      if (plugin[this.pluginProp]) {\n        ctx = plugin;\n        fn = plugin[this.pluginProp];\n      } else if (lib.isFunction(plugin)) {\n        fn = plugin;\n      } else if (lib.isObject(plugin)) {\n        fn = createKeyBasedPlugin(plugin);\n      }\n\n      return _Object$assign(fn.bind(ctx), {\n        pluginName: plugin.name || name,\n        isGenerator: lib.isGenerator(fn)\n      }); // Expected plugin interface: {key: string, plugin: fn*}\n      // This traverses depth-first and immediately applies yielded patches.\n      // This strategy should work well for most plugins (including the built-ins).\n      // We might consider making this (traversing & application) configurable later.\n\n      function createKeyBasedPlugin(pluginObj) {\n        var isSubPath = function isSubPath(path, tested) {\n          if (!Array.isArray(path)) {\n            return true;\n          }\n\n          return path.every(function (val, i) {\n            return val === tested[i];\n          });\n        };\n\n        return /*#__PURE__*/_regeneratorRuntime.mark(function generator(patches, specmap) {\n          var _marked, refCache, _iterator, _step, patch, traverse;\n\n          return _regeneratorRuntime.wrap(function generator$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  traverse = function _traverse(obj, path, patch) {\n                    var parentIndex, parent, indexOfFirstProperties, isRootProperties, traversed, _i, _Object$keys, key, val, updatedPath, isObj, objRef, isWithinPathDiscriminator;\n\n                    return _regeneratorRuntime.wrap(function traverse$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            if (lib.isObject(obj)) {\n                              _context4.next = 6;\n                              break;\n                            }\n\n                            if (!(pluginObj.key === path[path.length - 1])) {\n                              _context4.next = 4;\n                              break;\n                            }\n\n                            _context4.next = 4;\n                            return pluginObj.plugin(obj, pluginObj.key, path, specmap);\n\n                          case 4:\n                            _context4.next = 30;\n                            break;\n\n                          case 6:\n                            parentIndex = path.length - 1;\n                            parent = path[parentIndex];\n                            indexOfFirstProperties = path.indexOf('properties');\n                            isRootProperties = parent === 'properties' && parentIndex === indexOfFirstProperties;\n                            traversed = specmap.allowMetaPatches && refCache[obj.$$ref]; // eslint-disable-next-line no-restricted-syntax\n\n                            _i = 0, _Object$keys = _Object$keys2(obj);\n\n                          case 12:\n                            if (!(_i < _Object$keys.length)) {\n                              _context4.next = 30;\n                              break;\n                            }\n\n                            key = _Object$keys[_i];\n                            val = obj[key];\n                            updatedPath = _concatInstanceProperty(path).call(path, key);\n                            isObj = lib.isObject(val);\n                            objRef = obj.$$ref;\n\n                            if (traversed) {\n                              _context4.next = 22;\n                              break;\n                            }\n\n                            if (!isObj) {\n                              _context4.next = 22;\n                              break;\n                            }\n\n                            // Only store the ref if it exists\n                            if (specmap.allowMetaPatches && objRef) {\n                              refCache[objRef] = true;\n                            }\n\n                            return _context4.delegateYield(traverse(val, updatedPath, patch), \"t0\", 22);\n\n                          case 22:\n                            if (!(!isRootProperties && key === pluginObj.key)) {\n                              _context4.next = 27;\n                              break;\n                            }\n\n                            isWithinPathDiscriminator = isSubPath(pathDiscriminator, path);\n\n                            if (!(!pathDiscriminator || isWithinPathDiscriminator)) {\n                              _context4.next = 27;\n                              break;\n                            }\n\n                            _context4.next = 27;\n                            return pluginObj.plugin(val, key, updatedPath, specmap, patch);\n\n                          case 27:\n                            _i++;\n                            _context4.next = 12;\n                            break;\n\n                          case 30:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _marked);\n                  };\n\n                  _marked = /*#__PURE__*/_regeneratorRuntime.mark(traverse);\n                  refCache = {}; // eslint-disable-next-line no-restricted-syntax\n\n                  _iterator = _createForOfIteratorHelper(_filterInstanceProperty(patches).call(patches, lib.isAdditiveMutation));\n                  _context5.prev = 4;\n\n                  _iterator.s();\n\n                case 6:\n                  if ((_step = _iterator.n()).done) {\n                    _context5.next = 11;\n                    break;\n                  }\n\n                  patch = _step.value;\n                  return _context5.delegateYield(traverse(patch.value, patch.path, patch), \"t0\", 9);\n\n                case 9:\n                  _context5.next = 6;\n                  break;\n\n                case 11:\n                  _context5.next = 16;\n                  break;\n\n                case 13:\n                  _context5.prev = 13;\n                  _context5.t1 = _context5[\"catch\"](4);\n\n                  _iterator.e(_context5.t1);\n\n                case 16:\n                  _context5.prev = 16;\n\n                  _iterator.f();\n\n                  return _context5.finish(16);\n\n                case 19:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }, generator, null, [[4, 13, 16, 19]]);\n        });\n      }\n    }\n  }, {\n    key: \"nextPlugin\",\n    value: function nextPlugin() {\n      var _context6,\n          _this2 = this;\n\n      return _findInstanceProperty(_context6 = this.wrappedPlugins).call(_context6, function (plugin) {\n        var mutations = _this2.getMutationsForPlugin(plugin);\n\n        return mutations.length > 0;\n      });\n    }\n  }, {\n    key: \"nextPromisedPatch\",\n    value: function nextPromisedPatch() {\n      if (this.promisedPatches.length > 0) {\n        var _context7;\n\n        return _Promise.race(_mapInstanceProperty(_context7 = this.promisedPatches).call(_context7, function (patch) {\n          return patch.value;\n        }));\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"getPluginHistory\",\n    value: function getPluginHistory(plugin) {\n      var name = this.constructor.getPluginName(plugin);\n      return this.pluginHistory[name] || [];\n    }\n  }, {\n    key: \"getPluginRunCount\",\n    value: function getPluginRunCount(plugin) {\n      return this.getPluginHistory(plugin).length;\n    }\n  }, {\n    key: \"getPluginHistoryTip\",\n    value: function getPluginHistoryTip(plugin) {\n      var history = this.getPluginHistory(plugin);\n      var val = history && history[history.length - 1];\n      return val || {};\n    }\n  }, {\n    key: \"getPluginMutationIndex\",\n    value: function getPluginMutationIndex(plugin) {\n      var mi = this.getPluginHistoryTip(plugin).mutationIndex;\n      return typeof mi !== 'number' ? -1 : mi;\n    }\n  }, {\n    key: \"updatePluginHistory\",\n    value: function updatePluginHistory(plugin, val) {\n      var name = this.constructor.getPluginName(plugin);\n      this.pluginHistory[name] = this.pluginHistory[name] || [];\n      this.pluginHistory[name].push(val);\n    }\n  }, {\n    key: \"updatePatches\",\n    value: function updatePatches(patches) {\n      var _this3 = this;\n\n      lib.normalizeArray(patches).forEach(function (patch) {\n        if (patch instanceof Error) {\n          _this3.errors.push(patch);\n\n          return;\n        }\n\n        try {\n          if (!lib.isObject(patch)) {\n            _this3.debug('updatePatches', 'Got a non-object patch', patch);\n\n            return;\n          }\n\n          if (_this3.showDebug) {\n            _this3.allPatches.push(patch);\n          }\n\n          if (lib.isPromise(patch.value)) {\n            _this3.promisedPatches.push(patch);\n\n            _this3.promisedPatchThen(patch);\n\n            return;\n          }\n\n          if (lib.isContextPatch(patch)) {\n            _this3.setContext(patch.path, patch.value);\n\n            return;\n          }\n\n          if (lib.isMutation(patch)) {\n            _this3.updateMutations(patch);\n\n            return;\n          }\n        } catch (e) {\n          console.error(e); // eslint-disable-line no-console\n\n          _this3.errors.push(e);\n        }\n      });\n    }\n  }, {\n    key: \"updateMutations\",\n    value: function updateMutations(patch) {\n      if (_typeof(patch.value) === 'object' && !Array.isArray(patch.value) && this.allowMetaPatches) {\n        patch.value = _objectSpread({}, patch.value);\n      }\n\n      var result = lib.applyPatch(this.state, patch, {\n        allowMetaPatches: this.allowMetaPatches\n      });\n\n      if (result) {\n        this.mutations.push(patch);\n        this.state = result;\n      }\n    }\n  }, {\n    key: \"removePromisedPatch\",\n    value: function removePromisedPatch(patch) {\n      var _context8;\n\n      var index = this.promisedPatches.indexOf(patch);\n\n      if (index < 0) {\n        this.debug(\"Tried to remove a promisedPatch that isn't there!\");\n        return;\n      }\n\n      _spliceInstanceProperty(_context8 = this.promisedPatches).call(_context8, index, 1);\n    }\n  }, {\n    key: \"promisedPatchThen\",\n    value: function promisedPatchThen(patch) {\n      var _this4 = this;\n\n      patch.value = patch.value.then(function (val) {\n        var promisedPatch = _objectSpread(_objectSpread({}, patch), {}, {\n          value: val\n        });\n\n        _this4.removePromisedPatch(patch);\n\n        _this4.updatePatches(promisedPatch);\n      }).catch(function (e) {\n        _this4.removePromisedPatch(patch);\n\n        _this4.updatePatches(e);\n      });\n      return patch.value;\n    }\n  }, {\n    key: \"getMutations\",\n    value: function getMutations(from, to) {\n      var _context9;\n\n      from = from || 0;\n\n      if (typeof to !== 'number') {\n        to = this.mutations.length;\n      }\n\n      return _sliceInstanceProperty(_context9 = this.mutations).call(_context9, from, to);\n    }\n  }, {\n    key: \"getCurrentMutations\",\n    value: function getCurrentMutations() {\n      return this.getMutationsForPlugin(this.getCurrentPlugin());\n    }\n  }, {\n    key: \"getMutationsForPlugin\",\n    value: function getMutationsForPlugin(plugin) {\n      var tip = this.getPluginMutationIndex(plugin);\n      return this.getMutations(tip + 1);\n    }\n  }, {\n    key: \"getCurrentPlugin\",\n    value: function getCurrentPlugin() {\n      return this.currentPlugin;\n    }\n  }, {\n    key: \"getLib\",\n    value: function getLib() {\n      return this.libMethods;\n    } // eslint-disable-next-line no-underscore-dangle\n\n  }, {\n    key: \"_get\",\n    value: function _get(path) {\n      return lib.getIn(this.state, path);\n    } // eslint-disable-next-line no-underscore-dangle\n\n  }, {\n    key: \"_getContext\",\n    value: function _getContext(path) {\n      return this.contextTree.get(path);\n    }\n  }, {\n    key: \"setContext\",\n    value: function setContext(path, value) {\n      return this.contextTree.set(path, value);\n    } // eslint-disable-next-line no-underscore-dangle\n\n  }, {\n    key: \"_hasRun\",\n    value: function _hasRun(count) {\n      var times = this.getPluginRunCount(this.getCurrentPlugin());\n      return times > (count || 0);\n    }\n  }, {\n    key: \"dispatch\",\n    value: function dispatch() {\n      var _this5 = this;\n\n      var that = this;\n      var plugin = this.nextPlugin();\n\n      if (!plugin) {\n        var nextPromise = this.nextPromisedPatch();\n\n        if (nextPromise) {\n          return nextPromise.then(function () {\n            return _this5.dispatch();\n          }).catch(function () {\n            return _this5.dispatch();\n          });\n        } // We're done!\n\n\n        var result = {\n          spec: this.state,\n          errors: this.errors\n        };\n\n        if (this.showDebug) {\n          result.patches = this.allPatches;\n        }\n\n        return _Promise.resolve(result);\n      } // Makes sure plugin isn't running an endless loop\n\n\n      that.pluginCount = that.pluginCount || {};\n      that.pluginCount[plugin] = (that.pluginCount[plugin] || 0) + 1;\n\n      if (that.pluginCount[plugin] > HARD_LIMIT) {\n        var _context10;\n\n        return _Promise.resolve({\n          spec: that.state,\n          errors: _concatInstanceProperty(_context10 = that.errors).call(_context10, new Error(\"We've reached a hard limit of \".concat(HARD_LIMIT, \" plugin runs\")))\n        });\n      } // A different plugin runs, wait for all promises to resolve, then retry\n\n\n      if (plugin !== this.currentPlugin && this.promisedPatches.length) {\n        var _context11;\n\n        var promises = _mapInstanceProperty(_context11 = this.promisedPatches).call(_context11, function (p) {\n          return p.value;\n        }); // Waits for all to settle instead of Promise.all which stops on rejection\n\n\n        return _Promise.all(_mapInstanceProperty(promises).call(promises, function (promise) {\n          return promise.then(noop, noop);\n        })).then(function () {\n          return _this5.dispatch();\n        });\n      } // Ok, run the plugin\n\n\n      return executePlugin();\n\n      function executePlugin() {\n        that.currentPlugin = plugin;\n        var mutations = that.getCurrentMutations();\n        var lastMutationIndex = that.mutations.length - 1;\n\n        try {\n          if (plugin.isGenerator) {\n            // eslint-disable-next-line no-restricted-syntax\n            var _iterator2 = _createForOfIteratorHelper(plugin(mutations, that.getLib())),\n                _step2;\n\n            try {\n              for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                var yieldedPatches = _step2.value;\n                updatePatches(yieldedPatches);\n              }\n            } catch (err) {\n              _iterator2.e(err);\n            } finally {\n              _iterator2.f();\n            }\n          } else {\n            var newPatches = plugin(mutations, that.getLib());\n            updatePatches(newPatches);\n          }\n        } catch (e) {\n          console.error(e); // eslint-disable-line no-console\n\n          updatePatches([_Object$assign(Object.create(e), {\n            plugin: plugin\n          })]);\n        } finally {\n          that.updatePluginHistory(plugin, {\n            mutationIndex: lastMutationIndex\n          });\n        }\n\n        return that.dispatch();\n      }\n\n      function updatePatches(patches) {\n        if (patches) {\n          patches = lib.fullyNormalizeArray(patches);\n          that.updatePatches(patches, plugin);\n        }\n      }\n    }\n  }], [{\n    key: \"getPluginName\",\n    value: function getPluginName(plugin) {\n      return plugin.pluginName;\n    }\n  }, {\n    key: \"getPatchesOfType\",\n    value: function getPatchesOfType(patches, fn) {\n      return _filterInstanceProperty(patches).call(patches, fn);\n    }\n  }]);\n\n  return SpecMap;\n}();\n\nexport default function mapSpec(opts) {\n  return new SpecMap(opts).dispatch();\n}\nvar plugins = {\n  refs: refs,\n  allOf: allOf,\n  parameters: parameters,\n  properties: properties\n};\nexport { SpecMap, plugins };"]},"metadata":{},"sourceType":"module"}