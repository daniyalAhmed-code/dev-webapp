{"ast":null,"code":"import _slicedToArray from \"@babel/runtime-corejs3/helpers/slicedToArray\";\nimport _objectSpread from \"@babel/runtime-corejs3/helpers/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime-corejs3/helpers/objectWithoutProperties\";\nvar _excluded = [\"http\", \"fetch\", \"spec\", \"operationId\", \"pathName\", \"method\", \"parameters\", \"securities\"];\nimport _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";\nimport _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";\nimport _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";\nimport _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";\nimport _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";\nimport _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";\nimport _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";\nimport getIn from 'lodash/get';\nimport isPlainObject from 'lodash/isPlainObject';\nimport url from 'url';\nimport cookie from 'cookie';\nimport stockHttp, { mergeInQueryOrForm } from '../http';\nimport createError from '../specmap/lib/create-error';\nimport SWAGGER2_PARAMETER_BUILDERS from './swagger2/parameter-builders';\nimport * as OAS3_PARAMETER_BUILDERS from './oas3/parameter-builders';\nimport oas3BuildRequest from './oas3/build-request';\nimport swagger2BuildRequest from './swagger2/build-request';\nimport { getOperationRaw, legacyIdFromPathMethod, isOAS3 } from '../helpers';\n\nvar arrayOrEmpty = function arrayOrEmpty(ar) {\n  return Array.isArray(ar) ? ar : [];\n};\n\nvar OperationNotFoundError = createError('OperationNotFoundError', function cb(message, extra, oriError) {\n  this.originalError = oriError;\n\n  _Object$assign(this, extra || {});\n});\n\nvar findParametersWithName = function findParametersWithName(name, parameters) {\n  return _filterInstanceProperty(parameters).call(parameters, function (p) {\n    return p.name === name;\n  });\n}; // removes parameters that have duplicate 'in' and 'name' properties\n\n\nvar deduplicateParameters = function deduplicateParameters(parameters) {\n  var paramsMap = {};\n  parameters.forEach(function (p) {\n    if (!paramsMap[p.in]) {\n      paramsMap[p.in] = {};\n    }\n\n    paramsMap[p.in][p.name] = p;\n  });\n  var dedupedParameters = [];\n\n  _Object$keys(paramsMap).forEach(function (i) {\n    _Object$keys(paramsMap[i]).forEach(function (p) {\n      dedupedParameters.push(paramsMap[i][p]);\n    });\n  });\n\n  return dedupedParameters;\n}; // For stubbing in tests\n\n\nexport var self = {\n  buildRequest: buildRequest\n}; // Execute request, with the given operationId and parameters\n// pathName/method or operationId is optional\n\nexport function execute(_ref) {\n  var userHttp = _ref.http,\n      fetch = _ref.fetch,\n      spec = _ref.spec,\n      operationId = _ref.operationId,\n      pathName = _ref.pathName,\n      method = _ref.method,\n      parameters = _ref.parameters,\n      securities = _ref.securities,\n      extras = _objectWithoutProperties(_ref, _excluded); // Provide default fetch implementation\n\n\n  var http = userHttp || fetch || stockHttp; // Default to _our_ http\n\n  if (pathName && method && !operationId) {\n    operationId = legacyIdFromPathMethod(pathName, method);\n  }\n\n  var request = self.buildRequest(_objectSpread({\n    spec: spec,\n    operationId: operationId,\n    parameters: parameters,\n    securities: securities,\n    http: http\n  }, extras));\n\n  if (request.body && (isPlainObject(request.body) || Array.isArray(request.body))) {\n    request.body = _JSON$stringify(request.body);\n  } // Build request and execute it\n\n\n  return http(request);\n} // Build a request, which can be handled by the `http.js` implementation.\n\nexport function buildRequest(options) {\n  var _context, _context2;\n\n  var spec = options.spec,\n      operationId = options.operationId,\n      responseContentType = options.responseContentType,\n      scheme = options.scheme,\n      requestInterceptor = options.requestInterceptor,\n      responseInterceptor = options.responseInterceptor,\n      contextUrl = options.contextUrl,\n      userFetch = options.userFetch,\n      server = options.server,\n      serverVariables = options.serverVariables,\n      http = options.http;\n  var parameters = options.parameters,\n      parameterBuilders = options.parameterBuilders;\n  var specIsOAS3 = isOAS3(spec);\n\n  if (!parameterBuilders) {\n    // user did not provide custom parameter builders\n    if (specIsOAS3) {\n      parameterBuilders = OAS3_PARAMETER_BUILDERS;\n    } else {\n      parameterBuilders = SWAGGER2_PARAMETER_BUILDERS;\n    }\n  } // Set credentials with 'http.withCredentials' value\n\n\n  var credentials = http && http.withCredentials ? 'include' : 'same-origin'; // Base Template\n\n  var req = {\n    url: '',\n    credentials: credentials,\n    headers: {},\n    cookies: {}\n  };\n\n  if (requestInterceptor) {\n    req.requestInterceptor = requestInterceptor;\n  }\n\n  if (responseInterceptor) {\n    req.responseInterceptor = responseInterceptor;\n  }\n\n  if (userFetch) {\n    req.userFetch = userFetch;\n  }\n\n  var operationRaw = getOperationRaw(spec, operationId);\n\n  if (!operationRaw) {\n    throw new OperationNotFoundError(\"Operation \".concat(operationId, \" not found\"));\n  }\n\n  var _operationRaw$operati = operationRaw.operation,\n      operation = _operationRaw$operati === void 0 ? {} : _operationRaw$operati,\n      method = operationRaw.method,\n      pathName = operationRaw.pathName;\n  req.url += baseUrl({\n    spec: spec,\n    scheme: scheme,\n    contextUrl: contextUrl,\n    server: server,\n    serverVariables: serverVariables,\n    pathName: pathName,\n    method: method\n  }); // Mostly for testing\n\n  if (!operationId) {\n    // Not removing req.cookies causes testing issues and would\n    // change our interface, so we're always sure to remove it.\n    // See the same statement lower down in this function for\n    // more context.\n    delete req.cookies;\n    return req;\n  }\n\n  req.url += pathName; // Have not yet replaced the path parameters\n\n  req.method = \"\".concat(method).toUpperCase();\n  parameters = parameters || {};\n  var path = spec.paths[pathName] || {};\n\n  if (responseContentType) {\n    req.headers.accept = responseContentType;\n  }\n\n  var combinedParameters = deduplicateParameters(_concatInstanceProperty(_context = _concatInstanceProperty(_context2 = []).call(_context2, arrayOrEmpty(operation.parameters)) // operation parameters\n  ).call(_context, arrayOrEmpty(path.parameters))); // path parameters\n  // REVIEW: OAS3: have any key names or parameter shapes changed?\n  // Any new features that need to be plugged in here?\n  // Add values to request\n\n  combinedParameters.forEach(function (parameter) {\n    var builder = parameterBuilders[parameter.in];\n    var value;\n\n    if (parameter.in === 'body' && parameter.schema && parameter.schema.properties) {\n      value = parameters;\n    }\n\n    value = parameter && parameter.name && parameters[parameter.name];\n\n    if (typeof value === 'undefined') {\n      var _context3; // check for `name-in` formatted key\n\n\n      value = parameter && parameter.name && parameters[_concatInstanceProperty(_context3 = \"\".concat(parameter.in, \".\")).call(_context3, parameter.name)];\n    } else if (findParametersWithName(parameter.name, combinedParameters).length > 1) {\n      var _context4; // value came from `parameters[parameter.name]`\n      // check to see if this is an ambiguous parameter\n      // eslint-disable-next-line no-console\n\n\n      console.warn(_concatInstanceProperty(_context4 = \"Parameter '\".concat(parameter.name, \"' is ambiguous because the defined spec has more than one parameter with the name: '\")).call(_context4, parameter.name, \"' and the passed-in parameter values did not define an 'in' value.\"));\n    }\n\n    if (value === null) {\n      return;\n    }\n\n    if (typeof parameter.default !== 'undefined' && typeof value === 'undefined') {\n      value = parameter.default;\n    }\n\n    if (typeof value === 'undefined' && parameter.required && !parameter.allowEmptyValue) {\n      throw new Error(\"Required parameter \".concat(parameter.name, \" is not provided\"));\n    }\n\n    if (specIsOAS3 && parameter.schema && parameter.schema.type === 'object' && typeof value === 'string') {\n      try {\n        value = JSON.parse(value);\n      } catch (e) {\n        throw new Error('Could not parse object parameter value string as JSON');\n      }\n    }\n\n    if (builder) {\n      builder({\n        req: req,\n        parameter: parameter,\n        value: value,\n        operation: operation,\n        spec: spec\n      });\n    }\n  }); // Do version-specific tasks, then return those results.\n\n  var versionSpecificOptions = _objectSpread(_objectSpread({}, options), {}, {\n    operation: operation\n  });\n\n  if (specIsOAS3) {\n    req = oas3BuildRequest(versionSpecificOptions, req);\n  } else {\n    // If not OAS3, then treat as Swagger2.\n    req = swagger2BuildRequest(versionSpecificOptions, req);\n  } // If the cookie convenience object exists in our request,\n  // serialize its content and then delete the cookie object.\n\n\n  if (req.cookies && _Object$keys(req.cookies).length) {\n    var cookieString = _Object$keys(req.cookies).reduce(function (prev, cookieName) {\n      var cookieValue = req.cookies[cookieName];\n      var prefix = prev ? '&' : '';\n      var stringified = cookie.serialize(cookieName, cookieValue);\n      return prev + prefix + stringified;\n    }, '');\n\n    req.headers.Cookie = cookieString;\n  }\n\n  if (req.cookies) {\n    // even if no cookies were defined, we need to remove\n    // the cookies key from our request, or many many legacy\n    // tests will break.\n    delete req.cookies;\n  } // Will add the query object into the URL, if it exists\n  // ... will also create a FormData instance, if multipart/form-data (eg: a file)\n\n\n  mergeInQueryOrForm(req);\n  return req;\n}\n\nvar stripNonAlpha = function stripNonAlpha(str) {\n  return str ? str.replace(/\\W/g, '') : null;\n}; // be careful when modifying this! it is a publicly-exposed method.\n\n\nexport function baseUrl(obj) {\n  var specIsOAS3 = isOAS3(obj.spec);\n  return specIsOAS3 ? oas3BaseUrl(obj) : swagger2BaseUrl(obj);\n}\n\nfunction oas3BaseUrl(_ref2) {\n  var spec = _ref2.spec,\n      pathName = _ref2.pathName,\n      method = _ref2.method,\n      server = _ref2.server,\n      contextUrl = _ref2.contextUrl,\n      _ref2$serverVariables = _ref2.serverVariables,\n      serverVariables = _ref2$serverVariables === void 0 ? {} : _ref2$serverVariables;\n  var servers = getIn(spec, ['paths', pathName, (method || '').toLowerCase(), 'servers']) || getIn(spec, ['paths', pathName, 'servers']) || getIn(spec, ['servers']);\n  var selectedServerUrl = '';\n  var selectedServerObj = null;\n\n  if (server && servers && servers.length) {\n    var serverUrls = _mapInstanceProperty(servers).call(servers, function (srv) {\n      return srv.url;\n    });\n\n    if (serverUrls.indexOf(server) > -1) {\n      selectedServerUrl = server;\n      selectedServerObj = servers[serverUrls.indexOf(server)];\n    }\n  }\n\n  if (!selectedServerUrl && servers && servers.length) {\n    // default to the first server if we don't have one by now\n    selectedServerUrl = servers[0].url; // eslint-disable-line semi\n\n    var _servers = _slicedToArray(servers, 1);\n\n    selectedServerObj = _servers[0];\n  }\n\n  if (selectedServerUrl.indexOf('{') > -1) {\n    // do variable substitution\n    var varNames = getVariableTemplateNames(selectedServerUrl);\n    varNames.forEach(function (vari) {\n      if (selectedServerObj.variables && selectedServerObj.variables[vari]) {\n        // variable is defined in server\n        var variableDefinition = selectedServerObj.variables[vari];\n        var variableValue = serverVariables[vari] || variableDefinition.default;\n        var re = new RegExp(\"{\".concat(vari, \"}\"), 'g');\n        selectedServerUrl = selectedServerUrl.replace(re, variableValue);\n      }\n    });\n  }\n\n  return buildOas3UrlWithContext(selectedServerUrl, contextUrl);\n}\n\nfunction buildOas3UrlWithContext() {\n  var ourUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var contextUrl = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ''; // relative server url should be resolved against contextUrl\n\n  var parsedUrl = ourUrl && contextUrl ? url.parse(url.resolve(contextUrl, ourUrl)) : url.parse(ourUrl);\n  var parsedContextUrl = url.parse(contextUrl);\n  var computedScheme = stripNonAlpha(parsedUrl.protocol) || stripNonAlpha(parsedContextUrl.protocol) || '';\n  var computedHost = parsedUrl.host || parsedContextUrl.host;\n  var computedPath = parsedUrl.pathname || '';\n  var res;\n\n  if (computedScheme && computedHost) {\n    var _context5;\n\n    res = _concatInstanceProperty(_context5 = \"\".concat(computedScheme, \"://\")).call(_context5, computedHost + computedPath); // If last character is '/', trim it off\n  } else {\n    res = computedPath;\n  }\n\n  return res[res.length - 1] === '/' ? _sliceInstanceProperty(res).call(res, 0, -1) : res;\n}\n\nfunction getVariableTemplateNames(str) {\n  var results = [];\n  var re = /{([^}]+)}/g;\n  var text; // eslint-disable-next-line no-cond-assign\n\n  while (text = re.exec(str)) {\n    results.push(text[1]);\n  }\n\n  return results;\n} // Compose the baseUrl ( scheme + host + basePath )\n\n\nfunction swagger2BaseUrl(_ref3) {\n  var spec = _ref3.spec,\n      scheme = _ref3.scheme,\n      _ref3$contextUrl = _ref3.contextUrl,\n      contextUrl = _ref3$contextUrl === void 0 ? '' : _ref3$contextUrl;\n  var parsedContextUrl = url.parse(contextUrl);\n  var firstSchemeInSpec = Array.isArray(spec.schemes) ? spec.schemes[0] : null;\n  var computedScheme = scheme || firstSchemeInSpec || stripNonAlpha(parsedContextUrl.protocol) || 'http';\n  var computedHost = spec.host || parsedContextUrl.host || '';\n  var computedPath = spec.basePath || '';\n  var res;\n\n  if (computedScheme && computedHost) {\n    var _context6; // we have what we need for an absolute URL\n\n\n    res = _concatInstanceProperty(_context6 = \"\".concat(computedScheme, \"://\")).call(_context6, computedHost + computedPath);\n  } else {\n    // if not, a relative URL will have to do\n    res = computedPath;\n  } // If last character is '/', trim it off\n\n\n  return res[res.length - 1] === '/' ? _sliceInstanceProperty(res).call(res, 0, -1) : res;\n}","map":{"version":3,"sources":["/home/daniyal/Downloads/vap-webapp (1)/vap-webapp/web-content/static-asset-uploader/node_modules/swagger-client/es/execute/index.js"],"names":["_slicedToArray","_objectSpread","_objectWithoutProperties","_excluded","_Object$assign","_filterInstanceProperty","_Object$keys","_JSON$stringify","_concatInstanceProperty","_mapInstanceProperty","_sliceInstanceProperty","getIn","isPlainObject","url","cookie","stockHttp","mergeInQueryOrForm","createError","SWAGGER2_PARAMETER_BUILDERS","OAS3_PARAMETER_BUILDERS","oas3BuildRequest","swagger2BuildRequest","getOperationRaw","legacyIdFromPathMethod","isOAS3","arrayOrEmpty","ar","Array","isArray","OperationNotFoundError","cb","message","extra","oriError","originalError","findParametersWithName","name","parameters","call","p","deduplicateParameters","paramsMap","forEach","in","dedupedParameters","i","push","self","buildRequest","execute","_ref","userHttp","http","fetch","spec","operationId","pathName","method","securities","extras","request","body","options","_context","_context2","responseContentType","scheme","requestInterceptor","responseInterceptor","contextUrl","userFetch","server","serverVariables","parameterBuilders","specIsOAS3","credentials","withCredentials","req","headers","cookies","operationRaw","concat","_operationRaw$operati","operation","baseUrl","toUpperCase","path","paths","accept","combinedParameters","parameter","builder","value","schema","properties","_context3","length","_context4","console","warn","default","required","allowEmptyValue","Error","type","JSON","parse","e","versionSpecificOptions","cookieString","reduce","prev","cookieName","cookieValue","prefix","stringified","serialize","Cookie","stripNonAlpha","str","replace","obj","oas3BaseUrl","swagger2BaseUrl","_ref2","_ref2$serverVariables","servers","toLowerCase","selectedServerUrl","selectedServerObj","serverUrls","srv","indexOf","_servers","varNames","getVariableTemplateNames","vari","variables","variableDefinition","variableValue","re","RegExp","buildOas3UrlWithContext","ourUrl","arguments","undefined","parsedUrl","resolve","parsedContextUrl","computedScheme","protocol","computedHost","host","computedPath","pathname","res","_context5","results","text","exec","_ref3","_ref3$contextUrl","firstSchemeInSpec","schemes","basePath","_context6"],"mappings":"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","sourcesContent":["import _slicedToArray from \"@babel/runtime-corejs3/helpers/slicedToArray\";\nimport _objectSpread from \"@babel/runtime-corejs3/helpers/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime-corejs3/helpers/objectWithoutProperties\";\nvar _excluded = [\"http\", \"fetch\", \"spec\", \"operationId\", \"pathName\", \"method\", \"parameters\", \"securities\"];\nimport _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";\nimport _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";\nimport _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";\nimport _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";\nimport _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";\nimport _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";\nimport _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";\nimport getIn from 'lodash/get';\nimport isPlainObject from 'lodash/isPlainObject';\nimport url from 'url';\nimport cookie from 'cookie';\nimport stockHttp, { mergeInQueryOrForm } from '../http';\nimport createError from '../specmap/lib/create-error';\nimport SWAGGER2_PARAMETER_BUILDERS from './swagger2/parameter-builders';\nimport * as OAS3_PARAMETER_BUILDERS from './oas3/parameter-builders';\nimport oas3BuildRequest from './oas3/build-request';\nimport swagger2BuildRequest from './swagger2/build-request';\nimport { getOperationRaw, legacyIdFromPathMethod, isOAS3 } from '../helpers';\n\nvar arrayOrEmpty = function arrayOrEmpty(ar) {\n  return Array.isArray(ar) ? ar : [];\n};\n\nvar OperationNotFoundError = createError('OperationNotFoundError', function cb(message, extra, oriError) {\n  this.originalError = oriError;\n\n  _Object$assign(this, extra || {});\n});\n\nvar findParametersWithName = function findParametersWithName(name, parameters) {\n  return _filterInstanceProperty(parameters).call(parameters, function (p) {\n    return p.name === name;\n  });\n}; // removes parameters that have duplicate 'in' and 'name' properties\n\n\nvar deduplicateParameters = function deduplicateParameters(parameters) {\n  var paramsMap = {};\n  parameters.forEach(function (p) {\n    if (!paramsMap[p.in]) {\n      paramsMap[p.in] = {};\n    }\n\n    paramsMap[p.in][p.name] = p;\n  });\n  var dedupedParameters = [];\n\n  _Object$keys(paramsMap).forEach(function (i) {\n    _Object$keys(paramsMap[i]).forEach(function (p) {\n      dedupedParameters.push(paramsMap[i][p]);\n    });\n  });\n\n  return dedupedParameters;\n}; // For stubbing in tests\n\n\nexport var self = {\n  buildRequest: buildRequest\n}; // Execute request, with the given operationId and parameters\n// pathName/method or operationId is optional\n\nexport function execute(_ref) {\n  var userHttp = _ref.http,\n      fetch = _ref.fetch,\n      spec = _ref.spec,\n      operationId = _ref.operationId,\n      pathName = _ref.pathName,\n      method = _ref.method,\n      parameters = _ref.parameters,\n      securities = _ref.securities,\n      extras = _objectWithoutProperties(_ref, _excluded);\n\n  // Provide default fetch implementation\n  var http = userHttp || fetch || stockHttp; // Default to _our_ http\n\n  if (pathName && method && !operationId) {\n    operationId = legacyIdFromPathMethod(pathName, method);\n  }\n\n  var request = self.buildRequest(_objectSpread({\n    spec: spec,\n    operationId: operationId,\n    parameters: parameters,\n    securities: securities,\n    http: http\n  }, extras));\n\n  if (request.body && (isPlainObject(request.body) || Array.isArray(request.body))) {\n    request.body = _JSON$stringify(request.body);\n  } // Build request and execute it\n\n\n  return http(request);\n} // Build a request, which can be handled by the `http.js` implementation.\n\nexport function buildRequest(options) {\n  var _context, _context2;\n\n  var spec = options.spec,\n      operationId = options.operationId,\n      responseContentType = options.responseContentType,\n      scheme = options.scheme,\n      requestInterceptor = options.requestInterceptor,\n      responseInterceptor = options.responseInterceptor,\n      contextUrl = options.contextUrl,\n      userFetch = options.userFetch,\n      server = options.server,\n      serverVariables = options.serverVariables,\n      http = options.http;\n  var parameters = options.parameters,\n      parameterBuilders = options.parameterBuilders;\n  var specIsOAS3 = isOAS3(spec);\n\n  if (!parameterBuilders) {\n    // user did not provide custom parameter builders\n    if (specIsOAS3) {\n      parameterBuilders = OAS3_PARAMETER_BUILDERS;\n    } else {\n      parameterBuilders = SWAGGER2_PARAMETER_BUILDERS;\n    }\n  } // Set credentials with 'http.withCredentials' value\n\n\n  var credentials = http && http.withCredentials ? 'include' : 'same-origin'; // Base Template\n\n  var req = {\n    url: '',\n    credentials: credentials,\n    headers: {},\n    cookies: {}\n  };\n\n  if (requestInterceptor) {\n    req.requestInterceptor = requestInterceptor;\n  }\n\n  if (responseInterceptor) {\n    req.responseInterceptor = responseInterceptor;\n  }\n\n  if (userFetch) {\n    req.userFetch = userFetch;\n  }\n\n  var operationRaw = getOperationRaw(spec, operationId);\n\n  if (!operationRaw) {\n    throw new OperationNotFoundError(\"Operation \".concat(operationId, \" not found\"));\n  }\n\n  var _operationRaw$operati = operationRaw.operation,\n      operation = _operationRaw$operati === void 0 ? {} : _operationRaw$operati,\n      method = operationRaw.method,\n      pathName = operationRaw.pathName;\n  req.url += baseUrl({\n    spec: spec,\n    scheme: scheme,\n    contextUrl: contextUrl,\n    server: server,\n    serverVariables: serverVariables,\n    pathName: pathName,\n    method: method\n  }); // Mostly for testing\n\n  if (!operationId) {\n    // Not removing req.cookies causes testing issues and would\n    // change our interface, so we're always sure to remove it.\n    // See the same statement lower down in this function for\n    // more context.\n    delete req.cookies;\n    return req;\n  }\n\n  req.url += pathName; // Have not yet replaced the path parameters\n\n  req.method = \"\".concat(method).toUpperCase();\n  parameters = parameters || {};\n  var path = spec.paths[pathName] || {};\n\n  if (responseContentType) {\n    req.headers.accept = responseContentType;\n  }\n\n  var combinedParameters = deduplicateParameters(_concatInstanceProperty(_context = _concatInstanceProperty(_context2 = []).call(_context2, arrayOrEmpty(operation.parameters)) // operation parameters\n  ).call(_context, arrayOrEmpty(path.parameters))); // path parameters\n  // REVIEW: OAS3: have any key names or parameter shapes changed?\n  // Any new features that need to be plugged in here?\n  // Add values to request\n\n  combinedParameters.forEach(function (parameter) {\n    var builder = parameterBuilders[parameter.in];\n    var value;\n\n    if (parameter.in === 'body' && parameter.schema && parameter.schema.properties) {\n      value = parameters;\n    }\n\n    value = parameter && parameter.name && parameters[parameter.name];\n\n    if (typeof value === 'undefined') {\n      var _context3;\n\n      // check for `name-in` formatted key\n      value = parameter && parameter.name && parameters[_concatInstanceProperty(_context3 = \"\".concat(parameter.in, \".\")).call(_context3, parameter.name)];\n    } else if (findParametersWithName(parameter.name, combinedParameters).length > 1) {\n      var _context4;\n\n      // value came from `parameters[parameter.name]`\n      // check to see if this is an ambiguous parameter\n      // eslint-disable-next-line no-console\n      console.warn(_concatInstanceProperty(_context4 = \"Parameter '\".concat(parameter.name, \"' is ambiguous because the defined spec has more than one parameter with the name: '\")).call(_context4, parameter.name, \"' and the passed-in parameter values did not define an 'in' value.\"));\n    }\n\n    if (value === null) {\n      return;\n    }\n\n    if (typeof parameter.default !== 'undefined' && typeof value === 'undefined') {\n      value = parameter.default;\n    }\n\n    if (typeof value === 'undefined' && parameter.required && !parameter.allowEmptyValue) {\n      throw new Error(\"Required parameter \".concat(parameter.name, \" is not provided\"));\n    }\n\n    if (specIsOAS3 && parameter.schema && parameter.schema.type === 'object' && typeof value === 'string') {\n      try {\n        value = JSON.parse(value);\n      } catch (e) {\n        throw new Error('Could not parse object parameter value string as JSON');\n      }\n    }\n\n    if (builder) {\n      builder({\n        req: req,\n        parameter: parameter,\n        value: value,\n        operation: operation,\n        spec: spec\n      });\n    }\n  }); // Do version-specific tasks, then return those results.\n\n  var versionSpecificOptions = _objectSpread(_objectSpread({}, options), {}, {\n    operation: operation\n  });\n\n  if (specIsOAS3) {\n    req = oas3BuildRequest(versionSpecificOptions, req);\n  } else {\n    // If not OAS3, then treat as Swagger2.\n    req = swagger2BuildRequest(versionSpecificOptions, req);\n  } // If the cookie convenience object exists in our request,\n  // serialize its content and then delete the cookie object.\n\n\n  if (req.cookies && _Object$keys(req.cookies).length) {\n    var cookieString = _Object$keys(req.cookies).reduce(function (prev, cookieName) {\n      var cookieValue = req.cookies[cookieName];\n      var prefix = prev ? '&' : '';\n      var stringified = cookie.serialize(cookieName, cookieValue);\n      return prev + prefix + stringified;\n    }, '');\n\n    req.headers.Cookie = cookieString;\n  }\n\n  if (req.cookies) {\n    // even if no cookies were defined, we need to remove\n    // the cookies key from our request, or many many legacy\n    // tests will break.\n    delete req.cookies;\n  } // Will add the query object into the URL, if it exists\n  // ... will also create a FormData instance, if multipart/form-data (eg: a file)\n\n\n  mergeInQueryOrForm(req);\n  return req;\n}\n\nvar stripNonAlpha = function stripNonAlpha(str) {\n  return str ? str.replace(/\\W/g, '') : null;\n}; // be careful when modifying this! it is a publicly-exposed method.\n\n\nexport function baseUrl(obj) {\n  var specIsOAS3 = isOAS3(obj.spec);\n  return specIsOAS3 ? oas3BaseUrl(obj) : swagger2BaseUrl(obj);\n}\n\nfunction oas3BaseUrl(_ref2) {\n  var spec = _ref2.spec,\n      pathName = _ref2.pathName,\n      method = _ref2.method,\n      server = _ref2.server,\n      contextUrl = _ref2.contextUrl,\n      _ref2$serverVariables = _ref2.serverVariables,\n      serverVariables = _ref2$serverVariables === void 0 ? {} : _ref2$serverVariables;\n  var servers = getIn(spec, ['paths', pathName, (method || '').toLowerCase(), 'servers']) || getIn(spec, ['paths', pathName, 'servers']) || getIn(spec, ['servers']);\n  var selectedServerUrl = '';\n  var selectedServerObj = null;\n\n  if (server && servers && servers.length) {\n    var serverUrls = _mapInstanceProperty(servers).call(servers, function (srv) {\n      return srv.url;\n    });\n\n    if (serverUrls.indexOf(server) > -1) {\n      selectedServerUrl = server;\n      selectedServerObj = servers[serverUrls.indexOf(server)];\n    }\n  }\n\n  if (!selectedServerUrl && servers && servers.length) {\n    // default to the first server if we don't have one by now\n    selectedServerUrl = servers[0].url; // eslint-disable-line semi\n\n    var _servers = _slicedToArray(servers, 1);\n\n    selectedServerObj = _servers[0];\n  }\n\n  if (selectedServerUrl.indexOf('{') > -1) {\n    // do variable substitution\n    var varNames = getVariableTemplateNames(selectedServerUrl);\n    varNames.forEach(function (vari) {\n      if (selectedServerObj.variables && selectedServerObj.variables[vari]) {\n        // variable is defined in server\n        var variableDefinition = selectedServerObj.variables[vari];\n        var variableValue = serverVariables[vari] || variableDefinition.default;\n        var re = new RegExp(\"{\".concat(vari, \"}\"), 'g');\n        selectedServerUrl = selectedServerUrl.replace(re, variableValue);\n      }\n    });\n  }\n\n  return buildOas3UrlWithContext(selectedServerUrl, contextUrl);\n}\n\nfunction buildOas3UrlWithContext() {\n  var ourUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var contextUrl = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  // relative server url should be resolved against contextUrl\n  var parsedUrl = ourUrl && contextUrl ? url.parse(url.resolve(contextUrl, ourUrl)) : url.parse(ourUrl);\n  var parsedContextUrl = url.parse(contextUrl);\n  var computedScheme = stripNonAlpha(parsedUrl.protocol) || stripNonAlpha(parsedContextUrl.protocol) || '';\n  var computedHost = parsedUrl.host || parsedContextUrl.host;\n  var computedPath = parsedUrl.pathname || '';\n  var res;\n\n  if (computedScheme && computedHost) {\n    var _context5;\n\n    res = _concatInstanceProperty(_context5 = \"\".concat(computedScheme, \"://\")).call(_context5, computedHost + computedPath); // If last character is '/', trim it off\n  } else {\n    res = computedPath;\n  }\n\n  return res[res.length - 1] === '/' ? _sliceInstanceProperty(res).call(res, 0, -1) : res;\n}\n\nfunction getVariableTemplateNames(str) {\n  var results = [];\n  var re = /{([^}]+)}/g;\n  var text; // eslint-disable-next-line no-cond-assign\n\n  while (text = re.exec(str)) {\n    results.push(text[1]);\n  }\n\n  return results;\n} // Compose the baseUrl ( scheme + host + basePath )\n\n\nfunction swagger2BaseUrl(_ref3) {\n  var spec = _ref3.spec,\n      scheme = _ref3.scheme,\n      _ref3$contextUrl = _ref3.contextUrl,\n      contextUrl = _ref3$contextUrl === void 0 ? '' : _ref3$contextUrl;\n  var parsedContextUrl = url.parse(contextUrl);\n  var firstSchemeInSpec = Array.isArray(spec.schemes) ? spec.schemes[0] : null;\n  var computedScheme = scheme || firstSchemeInSpec || stripNonAlpha(parsedContextUrl.protocol) || 'http';\n  var computedHost = spec.host || parsedContextUrl.host || '';\n  var computedPath = spec.basePath || '';\n  var res;\n\n  if (computedScheme && computedHost) {\n    var _context6;\n\n    // we have what we need for an absolute URL\n    res = _concatInstanceProperty(_context6 = \"\".concat(computedScheme, \"://\")).call(_context6, computedHost + computedPath);\n  } else {\n    // if not, a relative URL will have to do\n    res = computedPath;\n  } // If last character is '/', trim it off\n\n\n  return res[res.length - 1] === '/' ? _sliceInstanceProperty(res).call(res, 0, -1) : res;\n}"]},"metadata":{},"sourceType":"module"}