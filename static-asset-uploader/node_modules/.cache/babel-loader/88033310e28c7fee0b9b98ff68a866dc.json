{"ast":null,"code":"import React from'react';import{Button,Loader,Table,Modal,Form,Message,Popup,Icon}from'semantic-ui-react';import{apiGatewayClientWithCredentials}from'services/api';import{getApi}from'services/api-catalog';import{store}from'services/state';import*as YAML from'yamljs';import hash from'object-hash';import{toJS}from'mobx';import{observer}from'mobx-react';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function getUsagePlanVisibility(usagePlan){let hasHidden=false;let hasVisible=false;for(const api of usagePlan.apis){if(api.visibility){if(hasHidden)return null;hasVisible=true;}else{if(hasVisible)return null;hasHidden=true;}}return hasVisible;}function removeFirst(array,item){const index=array.indexOf(item);const result=array.slice();result.splice(index,1);return result;}export const ApiManagement=observer(class ApiManagement extends React.Component{constructor(props){super(props);this.state={modalOpen:false,errors:[],// Simpler than implementing a multiset, and probably also faster.\n// TODO: abstract this out. It's getting a bit out of hand.\nplansDisplayToggling:[],apisDisplayToggling:[],apisUpdating:[],apisDeleting:[],apisTogglingSdks:[]};this.fileInput=/*#__PURE__*/React.createRef();this.tableSort=(first,second)=>{if(first.name!==second.name){return first.name.localeCompare(second.name);}else{return first.stage.localeCompare(second.stage);}};this.genericTableSort=(firstIndex,secondIndex)=>{const list=store.visibility.generic;if(list[firstIndex].name!==list[secondIndex].name){list[firstIndex].name.localeCompare(list[secondIndex].name);}else{// compare by their index, which happens to be their id\nreturn firstIndex.localeCompare(secondIndex);}};this.usagePlanSort=(first,second)=>{if(first.name!==second.name){return first.name.localeCompare(second.name);}else{return first.id.localeCompare(second.id);}};}componentDidMount(){this.getApiVisibility();}uploadAPISpec(event){event.preventDefault();const files=this.fileInput.current.files;let swagger,swaggerObject,anyFailures;if(files.length>0){this.setState(prev=>({...prev,errors:[]}));[].forEach.call(files,file=>{const reader=new window.FileReader();reader.onload=e=>{if(file.name.endsWith('.yaml')||file.name.endsWith('.yml')){swaggerObject=YAML.parse(e.target.result);swagger=JSON.stringify(swaggerObject);}else{swaggerObject=JSON.parse(e.target.result);swagger=JSON.stringify(swaggerObject);}if(!(swaggerObject.info&&swaggerObject.info.title)){anyFailures=true;this.setState(prev=>({...prev,errors:[...prev.errors,file.name]}));return;}if(anyFailures){return;}apiGatewayClientWithCredentials().then(app=>app.post('/admin/catalog/visibility',{},{swagger},{})).then(res=>{if(res.status===200){this.getApiVisibility();this.setState(prev=>({...prev,modalOpen:Boolean(anyFailures),errors:anyFailures?prev.errors:[]}));}});};reader.readAsText(file);});}}deleteAPISpec(apiId){this.setState(_ref=>{let{apisDeleting}=_ref;return{apisDeleting:[...apisDeleting,apiId]};});getApi(apiId,false,undefined,true).then(api=>{const _api=toJS(api);console.log(_api);const key=_api.stage?\"\".concat(_api.id,\"_\").concat(_api.stage):hash(_api.swagger);apiGatewayClientWithCredentials().then(app=>app.delete(\"/admin/catalog/visibility/generic/\".concat(key),{},{},{})).then(res=>{if(res.status===200)this.getApiVisibility();}).then(()=>this.setState(_ref2=>{let{apisDeleting}=_ref2;return{apisDeleting:removeFirst(apisDeleting,apiId)};}));});}getApiVisibility(){apiGatewayClientWithCredentials().then(app=>app.get('/admin/catalog/visibility',{},{},{})).then(res=>{if(res.status===200){// console.log(`visibility: ${JSON.stringify(res.data, null, 2)}`)\nconst apiGateway=res.data.apiGateway;const generic=res.data.generic&&Object.keys(res.data.generic);// console.log(`generic: ${JSON.stringify(generic, null, 2)}`)\n// console.log(`api gateway: ${JSON.stringify(apiGateway, null, 2)}`)\napiGateway.forEach(api=>{if(generic){generic.forEach(genApi=>{if(res.data.generic[\"\".concat(genApi)]){if(res.data.generic[\"\".concat(genApi)].apiId===api.id&&res.data.generic[\"\".concat(genApi)].stage===api.stage){api.visibility=true;delete res.data.generic[\"\".concat(genApi)];}}});}});store.visibility=res.data;}});}updateLocalApiGatewayApis(apisList,updatedApi,parity){const updatedApis=apisList.map(stateApi=>{if(stateApi.id===updatedApi.id&&stateApi.stage===updatedApi.stage){if(parity!==undefined&&(parity===true||parity===false)){stateApi.visibility=parity;}else{stateApi.visibility=!stateApi.visibility;}}return stateApi;});store.visibility={generic:store.visibility.generic,apiGateway:updatedApis};}showApiGatewayApi(api){const apiId=api.stage?\"\".concat(api.id,\"_\").concat(api.stage):api.id;this.setState(_ref3=>{let{apisDisplayToggling}=_ref3;return{apisDisplayToggling:[...apisDisplayToggling,apiId]};});apiGatewayClientWithCredentials().then(app=>app.post('/admin/catalog/visibility',{},{apiKey:\"\".concat(api.id,\"_\").concat(api.stage),subscribable:\"\".concat(api.subscribable)},{})).then(res=>{this.setState(_ref4=>{let{apisDisplayToggling}=_ref4;return{apisDisplayToggling:removeFirst(apisDisplayToggling,apiId)};});if(res.status===200){this.updateLocalApiGatewayApis(store.visibility.apiGateway,api);}});}hideApiGatewayApi(api){if(!api.subscribable&&!api.id&&!api.stage){this.deleteAPISpec(api.genericId);}else{const apiId=api.stage?\"\".concat(api.id,\"_\").concat(api.stage):api.id;this.setState(_ref5=>{let{apisDisplayToggling}=_ref5;return{apisDisplayToggling:[...apisDisplayToggling,apiId]};});apiGatewayClientWithCredentials().then(app=>app.delete(\"/admin/catalog/visibility/\".concat(api.id,\"_\").concat(api.stage),{},{},{})).then(res=>{this.setState(_ref6=>{let{apisDisplayToggling}=_ref6;return{apisDisplayToggling:removeFirst(apisDisplayToggling,apiId)};});if(res.status===200){this.updateLocalApiGatewayApis(store.visibility.apiGateway,api);}});}}showAllApiGatewayApis(usagePlan){// Only toggle APIs that aren't already shown.\nconst apiIds=usagePlan.apis.filter(api=>!api.visibility).map(api=>\"\".concat(api.id,\"_\").concat(api.stage));this.setState(_ref7=>{let{plansDisplayToggling,apisDisplayToggling}=_ref7;return{plansDisplayToggling:[...plansDisplayToggling,usagePlan.id],apisDisplayToggling:[...apisDisplayToggling,...apiIds]};});Promise.all(usagePlan.apis.map(api=>apiGatewayClientWithCredentials().then(app=>app.post('/admin/catalog/visibility',{},{apiKey:\"\".concat(api.id,\"_\").concat(api.stage),subscribable:\"\".concat(api.subscribable)},{})).then(res=>{res.api=api;return res;}))).then(promises=>{this.setState(_ref8=>{let{plansDisplayToggling,apisDisplayToggling}=_ref8;return{plansDisplayToggling:removeFirst(plansDisplayToggling,usagePlan.id),apisDisplayToggling:apiIds.reduce(removeFirst,apisDisplayToggling)};});promises.forEach(result=>{if(result.status===200){this.updateLocalApiGatewayApis(store.visibility.apiGateway,result.api,true);}});});}hideAllApiGatewayApis(usagePlan){// Only toggle APIs that aren't already hidden.\nconst apiIds=usagePlan.apis.filter(api=>api.visibility).map(api=>\"\".concat(api.id,\"_\").concat(api.stage));this.setState(_ref9=>{let{plansDisplayToggling,apisDisplayToggling}=_ref9;return{plansDisplayToggling:[...plansDisplayToggling,usagePlan.id],apisDisplayToggling:[...apisDisplayToggling,...apiIds]};});Promise.all(usagePlan.apis.map(api=>apiGatewayClientWithCredentials().then(app=>app.delete(\"/admin/catalog/visibility/\".concat(api.id,\"_\").concat(api.stage),{},{},{})).then(res=>{res.api=api;return res;}))).then(promises=>{this.setState(_ref10=>{let{plansDisplayToggling,apisDisplayToggling}=_ref10;return{plansDisplayToggling:removeFirst(plansDisplayToggling,usagePlan.id),apisDisplayToggling:apiIds.reduce(removeFirst,apisDisplayToggling)};});promises.forEach(result=>{if(result.status===200){this.updateLocalApiGatewayApis(store.visibility.apiGateway,result.api,false);}});});}isTogglingPlanDisplay(usagePlan){return this.state.plansDisplayToggling.includes(usagePlan.id);}isTogglingApiDisplay(api){return this.state.apisDisplayToggling.includes(api.stage?\"\".concat(api.id,\"_\").concat(api.stage):api.id);}isUpdatingApiGatewayApi(api){return this.state.apisUpdating.includes(\"\".concat(api.id,\"_\").concat(api.stage));}isRemovingUnmanagedApi(apiId){return this.state.apisDeleting.includes(apiId);}updateApiGatewayApi(api){this.setState(_ref11=>{let{apisUpdating}=_ref11;return{apisUpdating:[...apisUpdating,\"\".concat(api.id,\"_\").concat(api.stage)]};});apiGatewayClientWithCredentials().then(app=>app.post('/admin/catalog/visibility',{},{apiKey:\"\".concat(api.id,\"_\").concat(api.stage),subscribable:\"\".concat(api.subscribable)},{})).then(()=>this.setState(_ref12=>{let{apisUpdating}=_ref12;return{apisUpdating:removeFirst(apisUpdating,\"\".concat(api.id,\"_\").concat(api.stage))};}));}isSdkGenerationConfigurable(api){return api.visibility;}isTogglingSdkGeneration(api){return this.state.apisTogglingSdks.includes(\"\".concat(api.id,\"_\").concat(api.stage));}toggleSdkGeneration(apisList,updatedApi){this.setState(_ref13=>{let{apisTogglingSdks}=_ref13;return{apisTogglingSdks:[...apisTogglingSdks,\"\".concat(updatedApi.id,\"_\").concat(updatedApi.stage)]};});apiGatewayClientWithCredentials().then(app=>{if(updatedApi.sdkGeneration){return app.delete(\"/admin/catalog/\".concat(updatedApi.id,\"_\").concat(updatedApi.stage,\"/sdkGeneration\"),{},{},{});}else{return app.put(\"/admin/catalog/\".concat(updatedApi.id,\"_\").concat(updatedApi.stage,\"/sdkGeneration\"),{},{},{});}}).then(res=>{this.setState(_ref14=>{let{apisTogglingSdks}=_ref14;return{apisTogglingSdks:removeFirst(apisTogglingSdks,\"\".concat(updatedApi.id,\"_\").concat(updatedApi.stage))};});if(res.status===200){const updatedApis=apisList.map(stateApi=>{if(stateApi.id===updatedApi.id&&stateApi.stage===updatedApi.stage){stateApi.sdkGeneration=!stateApi.sdkGeneration;}return stateApi;});store.visibility.apiGateway=updatedApis;}});}renderHeaderVisibilityButton(usagePlan){const usagePlanVisibility=getUsagePlanVisibility(usagePlan);// Some APIs are visible, some are hidden. Show the current state (Partial, with a warning) and enable all on click\nif(usagePlanVisibility==null){return/*#__PURE__*/_jsx(Popup,{content:\"Users subscribed to any of the APIs in this usage plan will have a valid API key for all APIs in this usage plan, even those that are not visible!\",trigger:/*#__PURE__*/_jsx(Button,{basic:true,color:\"yellow\",style:{backgroundColor:'white',width:'100%',paddingLeft:'1em',paddingRight:'1em',minWidth:'88px'},onClick:()=>this.showAllApiGatewayApis(usagePlan),children:this.isTogglingPlanDisplay(usagePlan)?/*#__PURE__*/_jsx(Loader,{active:true,inline:true,size:\"mini\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[\"Partial \",/*#__PURE__*/_jsx(Icon,{name:\"warning sign\",style:{paddingLeft:'5px'}})]})})});}// Either all APIs are visible or none are visible. Toggle this state on click.\nreturn/*#__PURE__*/_jsx(Button,{basic:true,color:usagePlanVisibility?'green':'red',style:{backgroundColor:'white',width:'100%'},onClick:()=>{if(usagePlanVisibility)this.hideAllApiGatewayApis(usagePlan);else this.showAllApiGatewayApis(usagePlan);},children:this.isTogglingPlanDisplay(usagePlan)?/*#__PURE__*/_jsx(Loader,{active:true,inline:true,size:\"mini\"}):usagePlanVisibility?'True':'False'});}sortByUsagePlan(){if(!store.visibility.apiGateway){return this.renderNoApis();}const usagePlans=store.visibility.apiGateway.filter(api=>api.usagePlanId).reduce((accumulator,api)=>{if(!accumulator.find(usagePlan=>api.usagePlanId===usagePlan.id)){accumulator.push({id:api.usagePlanId,name:api.usagePlanName});}return accumulator;},[]).sort(this.usagePlanSort).map(usagePlan=>{return{...usagePlan,apis:store.visibility.apiGateway.filter(api=>api.usagePlanId===usagePlan.id).sort(this.tableSort)};});const unsubscribable=store.visibility.apiGateway.filter(api=>!api.usagePlanId).sort(this.tableSort);return/*#__PURE__*/_jsxs(_Fragment,{children:[usagePlans.map(usagePlan=>{return/*#__PURE__*/_jsxs(_Fragment,{children:[this.renderHeader(usagePlan),this.renderApiList(usagePlan.apis)]});}),/*#__PURE__*/_jsx(Table.Row,{style:{backgroundColor:'#1678c2',color:'white'},children:/*#__PURE__*/_jsxs(Table.Cell,{colSpan:\"6\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Not Subscribable\"}),\" \",/*#__PURE__*/_jsx(\"i\",{children:\"No Usage Plan\"})]})}),this.renderApiList(unsubscribable)]});}renderNoApis(){return/*#__PURE__*/_jsx(Table.Row,{children:/*#__PURE__*/_jsx(Table.Cell,{colSpan:\"4\",children:\"No APIs found\"})});}renderHeader(usagePlan){return/*#__PURE__*/_jsxs(Table.Row,{style:{backgroundColor:'#1678c2',color:'white'},children:[/*#__PURE__*/_jsxs(Table.Cell,{colSpan:\"3\",children:[/*#__PURE__*/_jsx(\"b\",{children:usagePlan&&usagePlan.name}),\" \",/*#__PURE__*/_jsx(\"i\",{children:\"Usage Plan\"})]}),/*#__PURE__*/_jsx(Table.Cell,{children:this.renderHeaderVisibilityButton(usagePlan)}),/*#__PURE__*/_jsx(Table.Cell,{colSpan:\"2\"})]});}renderApiList(apis){return/*#__PURE__*/_jsx(_Fragment,{children:apis.filter(api=>api.id!==window.config.restApiId).map(api=>/*#__PURE__*/_jsx(React.Fragment,{children:/*#__PURE__*/_jsxs(Table.Row,{children:[/*#__PURE__*/_jsx(Table.Cell,{collapsing:true,children:api.name}),/*#__PURE__*/_jsx(Table.Cell,{children:api.stage}),/*#__PURE__*/_jsx(Table.Cell,{children:api.subscribable?'Subscribable':'Not Subscribable'}),/*#__PURE__*/_jsx(Table.Cell,{children:/*#__PURE__*/_jsx(Button,{basic:true,color:api.visibility?'green':'red',style:{width:'100%'},onClick:()=>api.visibility?this.hideApiGatewayApi(api):this.showApiGatewayApi(api),children:this.isTogglingApiDisplay(api)?/*#__PURE__*/_jsx(Loader,{active:true,inline:true,size:\"mini\"}):api.visibility?'True':'False'})}),/*#__PURE__*/_jsx(Table.Cell,{children:/*#__PURE__*/_jsx(Button,{basic:true,color:\"blue\",disabled:!api.visibility,style:{width:'100%'},onClick:()=>this.updateApiGatewayApi(api),children:this.isUpdatingApiGatewayApi(api)?/*#__PURE__*/_jsx(Loader,{active:true,inline:true,size:\"mini\"}):'Update'})}),/*#__PURE__*/_jsx(Table.Cell,{children:/*#__PURE__*/_jsx(Button,{basic:true// color={api.sdkGeneration ? 'green' : 'red'}\n,color:\"blue\",style:{width:'100%'},disabled:!api.visibility||!this.isSdkGenerationConfigurable(api),onClick:()=>this.toggleSdkGeneration(store.visibility.apiGateway,api),children:this.isTogglingSdkGeneration(api)?/*#__PURE__*/_jsx(Loader,{active:true,inline:true,size:\"mini\"}):api.sdkGeneration?'Enabled':'Disabled'})})]})},api.stage?\"\".concat(api.id,\"_\").concat(api.stage):api.id))});}render(){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'2em'},children:/*#__PURE__*/_jsxs(Table,{celled:true,collapsing:true,children:[/*#__PURE__*/_jsx(Table.Header,{fullWidth:true,children:/*#__PURE__*/_jsx(Table.Row,{children:/*#__PURE__*/_jsx(Table.HeaderCell,{colSpan:\"6\",children:\"API Gateway APIs\"})})}),/*#__PURE__*/_jsx(Table.Header,{fullWidth:true,children:/*#__PURE__*/_jsxs(Table.Row,{children:[/*#__PURE__*/_jsx(Table.HeaderCell,{collapsing:true,sorted:\"ascending\",children:\"API Name\"}),/*#__PURE__*/_jsx(Table.HeaderCell,{children:\"Stage\"}),/*#__PURE__*/_jsx(Table.HeaderCell,{children:\"API Type\"}),/*#__PURE__*/_jsx(Table.HeaderCell,{children:\"Displayed\"}),/*#__PURE__*/_jsx(Table.HeaderCell,{children:\"Update\"}),/*#__PURE__*/_jsx(Table.HeaderCell,{children:\"Allow Generating SDKs\"})]})}),/*#__PURE__*/_jsx(Table.Body,{children:this.sortByUsagePlan()})]})}),/*#__PURE__*/_jsx(\"div\",{style:{padding:'2em'},children:/*#__PURE__*/_jsxs(Table,{celled:true,collapsing:true,children:[/*#__PURE__*/_jsx(Table.Header,{fullWidth:true,children:/*#__PURE__*/_jsx(Table.Row,{children:/*#__PURE__*/_jsx(Table.HeaderCell,{colSpan:\"4\",children:\"Generic APIs\"})})}),/*#__PURE__*/_jsx(Table.Header,{fullWidth:true,children:/*#__PURE__*/_jsx(Table.Row,{children:/*#__PURE__*/_jsx(Table.HeaderCell,{colSpan:\"2\",children:/*#__PURE__*/_jsxs(Modal,{closeIcon:true,closeOnEscape:true,closeOnDimmerClick:true,onClose:()=>this.setState(prev=>({...prev,modalOpen:false})),trigger:/*#__PURE__*/_jsx(Button,{floated:\"right\",onClick:()=>this.setState(prev=>({...prev,modalOpen:true})),children:\"Add API\"}),open:this.state.modalOpen,children:[/*#__PURE__*/_jsx(Modal.Header,{children:\"Select .JSON, .YAML, or .YML files\"}),/*#__PURE__*/_jsx(Modal.Content,{children:/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:e=>this.uploadAPISpec(e),children:[/*#__PURE__*/_jsxs(Form.Field,{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"files\",children:\"Select Files:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"files\",name:\"files\",accept:\".json,.yaml,.yml\",multiple:true,ref:this.fileInput})]}),!!this.state.errors.length&&/*#__PURE__*/_jsx(Message,{size:\"tiny\",color:\"red\",list:this.state.errors,header:\"These files are not parseable or do not contain an api title:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{type:\"submit\",children:\"Upload\"})]})})})]})})})}),/*#__PURE__*/_jsx(Table.Header,{fullWidth:true,children:/*#__PURE__*/_jsxs(Table.Row,{children:[/*#__PURE__*/_jsx(Table.HeaderCell,{collapsing:true,sorted:\"ascending\",children:\"API Name\"}),/*#__PURE__*/_jsx(Table.HeaderCell,{children:\"Delete\"})]})}),/*#__PURE__*/_jsx(Table.Body,{children:store.visibility.generic?Object.keys(store.visibility.generic).sort(this.genericTableSort).map(apiId=>/*#__PURE__*/_jsxs(Table.Row,{children:[/*#__PURE__*/_jsx(Table.Cell,{collapsing:true,children:store.visibility.generic[apiId].name}),/*#__PURE__*/_jsx(Table.Cell,{children:/*#__PURE__*/_jsx(Button,{basic:true,color:\"red\",disabled:this.isRemovingUnmanagedApi(apiId),onClick:()=>this.deleteAPISpec(apiId),children:this.isRemovingUnmanagedApi(apiId)?/*#__PURE__*/_jsx(Loader,{active:true,inline:true,size:\"mini\"}):'Delete'})})]},apiId)):/*#__PURE__*/_jsx(Table.Row,{children:/*#__PURE__*/_jsx(Table.Cell,{colSpan:\"4\",children:\"No APIs found\"})})})]})})]})});}});","map":{"version":3,"sources":["/home/daniyal/Downloads/vap-webapp (1)/vap-webapp/web-content/static-asset-uploader/src/pages/Admin/ApiManagement.jsx"],"names":["React","Button","Loader","Table","Modal","Form","Message","Popup","Icon","apiGatewayClientWithCredentials","getApi","store","YAML","hash","toJS","observer","getUsagePlanVisibility","usagePlan","hasHidden","hasVisible","api","apis","visibility","removeFirst","array","item","index","indexOf","result","slice","splice","ApiManagement","Component","constructor","props","state","modalOpen","errors","plansDisplayToggling","apisDisplayToggling","apisUpdating","apisDeleting","apisTogglingSdks","fileInput","createRef","tableSort","first","second","name","localeCompare","stage","genericTableSort","firstIndex","secondIndex","list","generic","usagePlanSort","id","componentDidMount","getApiVisibility","uploadAPISpec","event","preventDefault","files","current","swagger","swaggerObject","anyFailures","length","setState","prev","forEach","call","file","reader","window","FileReader","onload","e","endsWith","parse","target","JSON","stringify","info","title","then","app","post","res","status","Boolean","readAsText","deleteAPISpec","apiId","undefined","_api","console","log","key","delete","get","apiGateway","data","Object","keys","genApi","updateLocalApiGatewayApis","apisList","updatedApi","parity","updatedApis","map","stateApi","showApiGatewayApi","apiKey","subscribable","hideApiGatewayApi","genericId","showAllApiGatewayApis","apiIds","filter","Promise","all","promises","reduce","hideAllApiGatewayApis","isTogglingPlanDisplay","includes","isTogglingApiDisplay","isUpdatingApiGatewayApi","isRemovingUnmanagedApi","updateApiGatewayApi","isSdkGenerationConfigurable","isTogglingSdkGeneration","toggleSdkGeneration","sdkGeneration","put","renderHeaderVisibilityButton","usagePlanVisibility","backgroundColor","width","paddingLeft","paddingRight","minWidth","sortByUsagePlan","renderNoApis","usagePlans","usagePlanId","accumulator","find","push","usagePlanName","sort","unsubscribable","renderHeader","renderApiList","color","config","restApiId","render","display","padding"],"mappings":"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","sourcesContent":["import React from 'react'\n\nimport { Button, Loader, Table, Modal, Form, Message, Popup, Icon } from 'semantic-ui-react'\n\nimport { apiGatewayClientWithCredentials } from 'services/api'\nimport { getApi } from 'services/api-catalog'\nimport { store } from 'services/state'\n\nimport * as YAML from 'yamljs'\n\nimport hash from 'object-hash'\nimport { toJS } from 'mobx'\nimport { observer } from 'mobx-react'\n\nfunction getUsagePlanVisibility (usagePlan) {\n  let hasHidden = false\n  let hasVisible = false\n\n  for (const api of usagePlan.apis) {\n    if (api.visibility) {\n      if (hasHidden) return null\n      hasVisible = true\n    } else {\n      if (hasVisible) return null\n      hasHidden = true\n    }\n  }\n\n  return hasVisible\n}\n\nfunction removeFirst (array, item) {\n  const index = array.indexOf(item)\n  const result = array.slice()\n  result.splice(index, 1)\n  return result\n}\n\nexport const ApiManagement = observer(class ApiManagement extends React.Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      modalOpen: false,\n      errors: [],\n      // Simpler than implementing a multiset, and probably also faster.\n      // TODO: abstract this out. It's getting a bit out of hand.\n      plansDisplayToggling: [],\n      apisDisplayToggling: [],\n      apisUpdating: [],\n      apisDeleting: [],\n      apisTogglingSdks: []\n    }\n\n    this.fileInput = React.createRef()\n\n    this.tableSort = (first, second) => {\n      if (first.name !== second.name) {\n        return first.name.localeCompare(second.name)\n      } else {\n        return first.stage.localeCompare(second.stage)\n      }\n    }\n\n    this.genericTableSort = (firstIndex, secondIndex) => {\n      const list = store.visibility.generic\n\n      if (list[firstIndex].name !== list[secondIndex].name) {\n        list[firstIndex].name.localeCompare(list[secondIndex].name)\n      } else {\n        // compare by their index, which happens to be their id\n        return firstIndex.localeCompare(secondIndex)\n      }\n    }\n\n    this.usagePlanSort = (first, second) => {\n      if (first.name !== second.name) {\n        return first.name.localeCompare(second.name)\n      } else {\n        return first.id.localeCompare(second.id)\n      }\n    }\n  }\n\n  componentDidMount () {\n    this.getApiVisibility()\n  }\n\n  uploadAPISpec (event) {\n    event.preventDefault()\n\n    const files = this.fileInput.current.files\n    let swagger, swaggerObject, anyFailures\n\n    if (files.length > 0) {\n      this.setState(prev => ({ ...prev, errors: [] }))\n      ;[].forEach.call(files, file => {\n        const reader = new window.FileReader()\n\n        reader.onload = (e) => {\n          if (file.name.endsWith('.yaml') || file.name.endsWith('.yml')) {\n            swaggerObject = YAML.parse(e.target.result)\n            swagger = JSON.stringify(swaggerObject)\n          } else {\n            swaggerObject = JSON.parse(e.target.result)\n            swagger = JSON.stringify(swaggerObject)\n          }\n\n          if (!(swaggerObject.info && swaggerObject.info.title)) {\n            anyFailures = true\n            this.setState(prev => ({ ...prev, errors: [...prev.errors, file.name] }))\n            return\n          }\n\n          if (anyFailures) {\n            return\n          }\n\n          apiGatewayClientWithCredentials()\n            .then((app) => app.post('/admin/catalog/visibility', {}, { swagger }, {}))\n            .then((res) => {\n              if (res.status === 200) {\n                this.getApiVisibility()\n                this.setState(prev => ({ ...prev, modalOpen: Boolean(anyFailures), errors: anyFailures ? prev.errors : [] }))\n              }\n            })\n        }\n        reader.readAsText(file)\n      })\n    }\n  }\n\n  deleteAPISpec (apiId) {\n    this.setState(({ apisDeleting }) => ({ apisDeleting: [...apisDeleting, apiId] }))\n    getApi(apiId, false, undefined, true).then(api => {\n      const _api = toJS(api)\n      console.log(_api)\n      const key = _api.stage ? `${_api.id}_${_api.stage}` : hash(_api.swagger)\n      \n      apiGatewayClientWithCredentials()\n        .then(app => app.delete(`/admin/catalog/visibility/generic/${key}`, {}, {}, {}))\n        .then((res) => {\n          if (res.status === 200) this.getApiVisibility()\n        })\n        .then(() => this.setState(({ apisDeleting }) => ({ apisDeleting: removeFirst(apisDeleting, apiId) })))\n    })\n  }\n\n  getApiVisibility () {\n    apiGatewayClientWithCredentials()\n      .then(app => app.get('/admin/catalog/visibility', {}, {}, {}))\n      .then(res => {\n        if (res.status === 200) {\n          // console.log(`visibility: ${JSON.stringify(res.data, null, 2)}`)\n\n          const apiGateway = res.data.apiGateway\n          const generic = res.data.generic && Object.keys(res.data.generic)\n\n          // console.log(`generic: ${JSON.stringify(generic, null, 2)}`)\n          // console.log(`api gateway: ${JSON.stringify(apiGateway, null, 2)}`)\n\n          apiGateway.forEach(api => {\n            if (generic) {\n              generic.forEach(genApi => {\n                if (res.data.generic[`${genApi}`]) {\n                  if (\n                    res.data.generic[`${genApi}`].apiId === api.id &&\n                    res.data.generic[`${genApi}`].stage === api.stage\n                  ) {\n                    api.visibility = true\n                    delete res.data.generic[`${genApi}`]\n                  }\n                }\n              })\n            }\n          })\n\n          store.visibility = res.data\n        }\n      })\n  }\n\n  updateLocalApiGatewayApis (apisList, updatedApi, parity) {\n    const updatedApis = apisList.map(stateApi => {\n      if (stateApi.id === updatedApi.id && stateApi.stage === updatedApi.stage) {\n        if (parity !== undefined && (parity === true || parity === false)) {\n          stateApi.visibility = parity\n        } else {\n          stateApi.visibility = !stateApi.visibility\n        }\n      }\n      return stateApi\n    })\n\n    store.visibility = { generic: store.visibility.generic, apiGateway: updatedApis }\n  }\n\n  showApiGatewayApi (api) {\n    const apiId = api.stage ? `${api.id}_${api.stage}` : api.id\n    this.setState(({ apisDisplayToggling }) => ({ apisDisplayToggling: [...apisDisplayToggling, apiId] }))\n    apiGatewayClientWithCredentials()\n      .then(app => app.post('/admin/catalog/visibility', {}, { apiKey: `${api.id}_${api.stage}`, subscribable: `${api.subscribable}` }, {}))\n      .then((res) => {\n        this.setState(({ apisDisplayToggling }) => ({ apisDisplayToggling: removeFirst(apisDisplayToggling, apiId) }))\n        if (res.status === 200) {\n          this.updateLocalApiGatewayApis(store.visibility.apiGateway, api)\n        }\n      })\n  }\n\n  hideApiGatewayApi (api) {\n    if (!api.subscribable && !api.id && !api.stage) {\n      this.deleteAPISpec(api.genericId)\n    } else {\n      const apiId = api.stage ? `${api.id}_${api.stage}` : api.id\n      this.setState(({ apisDisplayToggling }) => ({ apisDisplayToggling: [...apisDisplayToggling, apiId] }))\n      apiGatewayClientWithCredentials()\n        .then(app => app.delete(`/admin/catalog/visibility/${api.id}_${api.stage}`, {}, {}, {}))\n        .then((res) => {\n          this.setState(({ apisDisplayToggling }) => ({ apisDisplayToggling: removeFirst(apisDisplayToggling, apiId) }))\n          if (res.status === 200) {\n            this.updateLocalApiGatewayApis(store.visibility.apiGateway, api)\n          }\n        })\n    }\n  }\n\n  showAllApiGatewayApis (usagePlan) {\n    // Only toggle APIs that aren't already shown.\n    const apiIds = usagePlan.apis.filter(api => !api.visibility).map(api => `${api.id}_${api.stage}`)\n    this.setState(({ plansDisplayToggling, apisDisplayToggling }) => ({\n      plansDisplayToggling: [...plansDisplayToggling, usagePlan.id],\n      apisDisplayToggling: [...apisDisplayToggling, ...apiIds]\n    }))\n    Promise.all(usagePlan.apis.map((api) =>\n      apiGatewayClientWithCredentials()\n        .then(app => app.post('/admin/catalog/visibility', {}, {\n          apiKey: `${api.id}_${api.stage}`,\n          subscribable: `${api.subscribable}`\n        }, {}))\n        .then(res => { res.api = api; return res })\n    )).then((promises) => {\n      this.setState(({ plansDisplayToggling, apisDisplayToggling }) => ({\n        plansDisplayToggling: removeFirst(plansDisplayToggling, usagePlan.id),\n        apisDisplayToggling: apiIds.reduce(removeFirst, apisDisplayToggling)\n      }))\n      promises.forEach((result) => {\n        if (result.status === 200) {\n          this.updateLocalApiGatewayApis(store.visibility.apiGateway, result.api, true)\n        }\n      })\n    })\n  }\n\n  hideAllApiGatewayApis (usagePlan) {\n    // Only toggle APIs that aren't already hidden.\n    const apiIds = usagePlan.apis.filter(api => api.visibility).map(api => `${api.id}_${api.stage}`)\n    this.setState(({ plansDisplayToggling, apisDisplayToggling }) => ({\n      plansDisplayToggling: [...plansDisplayToggling, usagePlan.id],\n      apisDisplayToggling: [...apisDisplayToggling, ...apiIds]\n    }))\n    Promise.all(usagePlan.apis.map((api) =>\n      apiGatewayClientWithCredentials()\n        .then(app => app.delete(`/admin/catalog/visibility/${api.id}_${api.stage}`, {}, {}, {}))\n        .then(res => { res.api = api; return res })\n    )).then((promises) => {\n      this.setState(({ plansDisplayToggling, apisDisplayToggling }) => ({\n        plansDisplayToggling: removeFirst(plansDisplayToggling, usagePlan.id),\n        apisDisplayToggling: apiIds.reduce(removeFirst, apisDisplayToggling)\n      }))\n      promises.forEach((result) => {\n        if (result.status === 200) {\n          this.updateLocalApiGatewayApis(store.visibility.apiGateway, result.api, false)\n        }\n      })\n    })\n  }\n\n  isTogglingPlanDisplay (usagePlan) {\n    return this.state.plansDisplayToggling.includes(usagePlan.id)\n  }\n\n  isTogglingApiDisplay (api) {\n    return this.state.apisDisplayToggling.includes(api.stage ? `${api.id}_${api.stage}` : api.id)\n  }\n\n  isUpdatingApiGatewayApi (api) {\n    return this.state.apisUpdating.includes(`${api.id}_${api.stage}`)\n  }\n\n  isRemovingUnmanagedApi (apiId) {\n    return this.state.apisDeleting.includes(apiId)\n  }\n\n  updateApiGatewayApi (api) {\n    this.setState(({ apisUpdating }) => ({\n      apisUpdating: [...apisUpdating, `${api.id}_${api.stage}`]\n    }))\n    apiGatewayClientWithCredentials()\n      .then(app => app.post('/admin/catalog/visibility', {}, { apiKey: `${api.id}_${api.stage}`, subscribable: `${api.subscribable}` }, {}))\n      .then(() => this.setState(({ apisUpdating }) => ({ apisUpdating: removeFirst(apisUpdating, `${api.id}_${api.stage}`) })))\n  }\n\n  isSdkGenerationConfigurable (api) {\n    return api.visibility\n  }\n\n  isTogglingSdkGeneration (api) {\n    return this.state.apisTogglingSdks.includes(`${api.id}_${api.stage}`)\n  }\n\n  toggleSdkGeneration (apisList, updatedApi) {\n    this.setState(({ apisTogglingSdks }) => ({\n      apisTogglingSdks: [...apisTogglingSdks, `${updatedApi.id}_${updatedApi.stage}`]\n    }))\n    apiGatewayClientWithCredentials()\n      .then(app => {\n        if (updatedApi.sdkGeneration) {\n          return app.delete(`/admin/catalog/${updatedApi.id}_${updatedApi.stage}/sdkGeneration`, {}, {}, {})\n        } else {\n          return app.put(`/admin/catalog/${updatedApi.id}_${updatedApi.stage}/sdkGeneration`, {}, {}, {})\n        }\n      })\n      .then(res => {\n        this.setState(({ apisTogglingSdks }) => ({ apisTogglingSdks: removeFirst(apisTogglingSdks, `${updatedApi.id}_${updatedApi.stage}`) }))\n        if (res.status === 200) {\n          const updatedApis = apisList.map(stateApi => {\n            if (stateApi.id === updatedApi.id && stateApi.stage === updatedApi.stage) {\n              stateApi.sdkGeneration = !stateApi.sdkGeneration\n            }\n            return stateApi\n          })\n\n          store.visibility.apiGateway = updatedApis\n        }\n      })\n  }\n\n  renderHeaderVisibilityButton (usagePlan) {\n    const usagePlanVisibility = getUsagePlanVisibility(usagePlan)\n\n    // Some APIs are visible, some are hidden. Show the current state (Partial, with a warning) and enable all on click\n    if (usagePlanVisibility == null) {\n      return (\n        <Popup\n          content='Users subscribed to any of the APIs in this usage plan will have a valid API key for all APIs in this usage plan, even those that are not visible!'\n          trigger={\n            <Button\n              basic\n              color='yellow'\n              style={{ backgroundColor: 'white', width: '100%', paddingLeft: '1em', paddingRight: '1em', minWidth: '88px' }}\n              onClick={() => this.showAllApiGatewayApis(usagePlan)}\n            >\n              {this.isTogglingPlanDisplay(usagePlan) ? <Loader active inline size='mini' /> : <>Partial <Icon name='warning sign' style={{ paddingLeft: '5px' }} /></>}\n            </Button>\n          }\n        />\n      )\n    }\n\n    // Either all APIs are visible or none are visible. Toggle this state on click.\n    return (\n      <Button\n        basic\n        color={usagePlanVisibility ? 'green' : 'red'}\n        style={{ backgroundColor: 'white', width: '100%' }}\n        onClick={() => {\n          if (usagePlanVisibility) this.hideAllApiGatewayApis(usagePlan)\n          else this.showAllApiGatewayApis(usagePlan)\n        }}\n      >\n        {this.isTogglingPlanDisplay(usagePlan) ? <Loader active inline size='mini' /> : usagePlanVisibility ? 'True' : 'False'}\n      </Button>\n    )\n  }\n\n  sortByUsagePlan () {\n    if (!store.visibility.apiGateway) { return this.renderNoApis() }\n\n    const usagePlans =\n      store.visibility.apiGateway\n        .filter((api) => api.usagePlanId)\n        .reduce((accumulator, api) => {\n          if (!accumulator.find((usagePlan) => api.usagePlanId === usagePlan.id)) {\n            accumulator.push({ id: api.usagePlanId, name: api.usagePlanName })\n          }\n          return accumulator\n        }, [])\n        .sort(this.usagePlanSort)\n        .map((usagePlan) => {\n          return { ...usagePlan, apis: store.visibility.apiGateway.filter((api) => api.usagePlanId === usagePlan.id).sort(this.tableSort) }\n        })\n    const unsubscribable =\n      store.visibility.apiGateway\n        .filter((api) => !api.usagePlanId)\n        .sort(this.tableSort)\n\n    return (\n      <>\n        {usagePlans.map(usagePlan => {\n          return (\n            <>\n              {this.renderHeader(usagePlan)}\n              {this.renderApiList(usagePlan.apis)}\n            </>\n          )\n        })}\n        <Table.Row style={{ backgroundColor: '#1678c2', color: 'white' }}>\n          <Table.Cell colSpan='6'>\n            <b>Not Subscribable</b> <i>No Usage Plan</i>\n          </Table.Cell>\n        </Table.Row>\n        {this.renderApiList(unsubscribable)}\n      </>\n    )\n  }\n\n  renderNoApis () {\n    return (\n      <Table.Row>\n        <Table.Cell colSpan='4'>\n          No APIs found\n        </Table.Cell>\n      </Table.Row>\n    )\n  }\n\n  renderHeader (usagePlan) {\n    return (\n      <Table.Row style={{ backgroundColor: '#1678c2', color: 'white' }}>\n        <Table.Cell colSpan='3'>\n          <b>{usagePlan && usagePlan.name}</b> <i>Usage Plan</i>\n        </Table.Cell>\n        <Table.Cell>\n          {this.renderHeaderVisibilityButton(usagePlan)}\n        </Table.Cell>\n        <Table.Cell colSpan='2'>\n          {/* Intentionally empty */}\n        </Table.Cell>\n      </Table.Row>\n    )\n  }\n\n  renderApiList (apis) {\n    return <>\n      {apis.filter(api => api.id !== window.config.restApiId).map(api => (\n        <React.Fragment key={api.stage ? `${api.id}_${api.stage}` : api.id}>\n          <Table.Row>\n            <Table.Cell collapsing>{api.name}</Table.Cell>\n            <Table.Cell>{api.stage}</Table.Cell>\n            <Table.Cell>{api.subscribable ? 'Subscribable' : 'Not Subscribable'}</Table.Cell>\n            <Table.Cell>\n              <Button\n                basic\n                color={api.visibility ? 'green' : 'red'}\n                style={{ width: '100%' }}\n                onClick={() => api.visibility ? this.hideApiGatewayApi(api) : this.showApiGatewayApi(api)}\n              >\n                {this.isTogglingApiDisplay(api) ? <Loader active inline size='mini' /> : api.visibility ? 'True' : 'False'}\n              </Button>\n            </Table.Cell>\n            <Table.Cell>\n              <Button\n                basic\n                color='blue'\n                disabled={!api.visibility}\n                style={{ width: '100%' }}\n                onClick={() => this.updateApiGatewayApi(api)}\n              >\n                {this.isUpdatingApiGatewayApi(api) ? <Loader active inline size='mini' /> : 'Update'}\n              </Button>\n            </Table.Cell>\n            <Table.Cell>\n              <Button\n                basic\n                // color={api.sdkGeneration ? 'green' : 'red'}\n                color='blue'\n                style={{ width: '100%' }}\n                disabled={!api.visibility || !this.isSdkGenerationConfigurable(api)}\n                onClick={() => this.toggleSdkGeneration(store.visibility.apiGateway, api)}\n              >\n                {this.isTogglingSdkGeneration(api) ? <Loader active inline size='mini' /> : api.sdkGeneration ? 'Enabled' : 'Disabled'}\n              </Button>\n            </Table.Cell>\n          </Table.Row>\n        </React.Fragment>\n      ))}\n    </>\n  }\n\n  render () {\n    return <>\n      <div style={{ display: 'flex', width: '100%' }}>\n        <div style={{ padding: '2em' }}>\n          <Table celled collapsing>\n            <Table.Header fullWidth>\n              <Table.Row>\n                <Table.HeaderCell colSpan='6'>API Gateway APIs</Table.HeaderCell>\n              </Table.Row>\n            </Table.Header>\n            <Table.Header fullWidth>\n              <Table.Row>\n                <Table.HeaderCell collapsing sorted='ascending'>API Name</Table.HeaderCell>\n                <Table.HeaderCell>Stage</Table.HeaderCell>\n                <Table.HeaderCell>API Type</Table.HeaderCell>\n                <Table.HeaderCell>Displayed</Table.HeaderCell>\n                <Table.HeaderCell>Update</Table.HeaderCell>\n                <Table.HeaderCell>Allow Generating SDKs</Table.HeaderCell>\n              </Table.Row>\n            </Table.Header>\n            <Table.Body>\n              {this.sortByUsagePlan()}\n            </Table.Body>\n          </Table>\n        </div>\n\n        <div style={{ padding: '2em' }}>\n          <Table celled collapsing>\n            <Table.Header fullWidth>\n              <Table.Row>\n                <Table.HeaderCell colSpan='4'>Generic APIs</Table.HeaderCell>\n              </Table.Row>\n            </Table.Header>\n            <Table.Header fullWidth>\n              <Table.Row>\n                <Table.HeaderCell colSpan='2'>\n                  <Modal\n                    closeIcon\n                    closeOnEscape\n                    closeOnDimmerClick\n                    onClose={() => this.setState((prev) => ({ ...prev, modalOpen: false }))}\n                    trigger={\n                      <Button floated='right' onClick={() => this.setState((prev) => ({ ...prev, modalOpen: true }))}>\n                        Add API\n                      </Button>\n                    }\n                    open={this.state.modalOpen}\n                  >\n                    <Modal.Header>Select .JSON, .YAML, or .YML files</Modal.Header>\n                    <Modal.Content>\n                      <>\n                        <Form onSubmit={(e) => this.uploadAPISpec(e)}>\n                          <Form.Field>\n                            <label htmlFor='files'>Select Files:</label>\n                            <input type='file' id='files' name='files' accept='.json,.yaml,.yml' multiple ref={this.fileInput} />\n                          </Form.Field>\n                          {!!this.state.errors.length &&\n                            <Message size='tiny' color='red' list={this.state.errors} header='These files are not parseable or do not contain an api title:' />}\n                          <br />\n                          <Button type='submit'>Upload</Button>\n                        </Form>\n                      </>\n                    </Modal.Content>\n                  </Modal>\n                </Table.HeaderCell>\n              </Table.Row>\n            </Table.Header>\n            <Table.Header fullWidth>\n              <Table.Row>\n                <Table.HeaderCell collapsing sorted='ascending'>API Name</Table.HeaderCell>\n                <Table.HeaderCell>Delete</Table.HeaderCell>\n              </Table.Row>\n            </Table.Header>\n            <Table.Body>\n              {store.visibility.generic\n                ? Object.keys(store.visibility.generic).sort(this.genericTableSort).map(apiId => (\n                  <Table.Row key={apiId}>\n                    <Table.Cell collapsing>{store.visibility.generic[apiId].name}</Table.Cell>\n                    <Table.Cell>\n                      <Button\n                        basic\n                        color='red'\n                        disabled={this.isRemovingUnmanagedApi(apiId)}\n                        onClick={() => this.deleteAPISpec(apiId)}\n                      >\n                        {this.isRemovingUnmanagedApi(apiId) ? <Loader active inline size='mini' /> : 'Delete'}\n                      </Button>\n                    </Table.Cell>\n                  </Table.Row>\n                ))\n                : (\n                  <Table.Row>\n                    <Table.Cell colSpan='4'>\n                      No APIs found\n                    </Table.Cell>\n                  </Table.Row>\n                )}\n            </Table.Body>\n          </Table>\n        </div>\n      </div>\n    </>\n  }\n})\n"]},"metadata":{},"sourceType":"module"}